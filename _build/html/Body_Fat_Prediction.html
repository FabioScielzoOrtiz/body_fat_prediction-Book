
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Body Fat Prediction with Machine Learning &#8212; Body Fat Prediction</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Body_Fat_Prediction';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Body Fat Prediction" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Body Fat Prediction - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Body Fat Prediction - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Body Fat Prediction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Body Fat Prediction with Machine Learning</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Body_Fat_Prediction" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Body_Fat_Prediction/issues/new?title=Issue%20on%20page%20%2FBody_Fat_Prediction.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Body_Fat_Prediction.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Body Fat Prediction with Machine Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem"><strong>The problem</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dimensions"><strong>Dimensions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types"><strong>Data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unique-values"><strong>Unique values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values"><strong>Missing values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-analysis"><strong>Response analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-between-response-and-predictors"><strong>Relation between response and predictors</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-methods"><strong>Preprocessing Methods</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imputers"><strong>Imputers</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-imputer"><strong>Simple imputer</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-imputer"><strong>KNN imputer</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#iterative-imputer"><strong>Iterative imputer</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#visual-explanation-of-iterative-imputer"><strong>Visual explanation of Iterative imputer</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretization"><strong>Discretization</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quantiles-rule"><strong>Quantiles rule</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-rule"><strong>k-means rule</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-selection"><strong>Features Selection</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#f-value"><strong>F-value</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fpr-false-positive-rate"><strong>Fpr (False Positive Rate)</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fwe-family-wise-error"><strong>Fwe (Family Wise Error)</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fde-false-discovery-error"><strong>Fde (False Discovery Error)</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#best-subset-selection"><strong>Best subset selection</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-selection"><strong>Backward selection</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection"><strong>Forward selection</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models"><strong>Models</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression"><strong>Linear Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-estimation"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictions"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-curse-of-dimensionality"><strong>The Curse of Dimensionality</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penalized-linear-regression"><strong>Penalized Linear Regression</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression"><strong>Ridge Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hyper-parameters"><strong>Hyper-parameters</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-ridge-regression"><strong>Advantages of Ridge regression</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#disadvantages-of-ridge-regression"><strong>Disadvantages of Ridge Regression</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso-regression"><strong>Lasso Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elasticnet-regression"><strong>ElasticNet Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#knn"><strong>KNN</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Hyper-parameters</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-trees"><strong>Regression Trees</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#branches-definition"><strong>Branches definition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-binary-partition-algorithm"><strong>Recursive binary partition algorithm</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ensembles"><strong>Ensembles</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging"><strong>Bagging</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id15"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest"><strong>Random Forest</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id16"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-trees"><strong>Extra-Trees</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id17"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boosting"><strong>Boosting</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#stacking"><strong>Stacking</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-outer-evaluation"><strong>Inner-Outer Evaluation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation"><strong>Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-validation"><strong>Simple Validation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#k-fold-cross-validation"><strong>k-Fold Cross Validation</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation"><strong>Evaluation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-types"><strong>Evaluation types</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-schemas"><strong>Evaluation schemas</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-workflow"><strong>Machine Learning Workflow</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-and-predictors-definition"><strong>Response and predictors definition</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hpo"><strong>HPO</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelines-definition"><strong>Pipelines definition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#grids-for-hpo"><strong>Grids for HPO</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-outer-definition"><strong>Inner-Outer definition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-evaluation-hpo"><strong>Inner Evaluation (HPO)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id18"><strong>KNN</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging-knn"><strong>Bagging KNN</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id19"><strong>Linear Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-linear-regression"><strong>Backward Linear Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-linear-regression"><strong>Forward Linear Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id20"><strong>Ridge Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id21"><strong>Lasso Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id22"><strong>ElasticNet Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#trees"><strong>Trees</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id23"><strong>Extra-Trees</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#boosting-trees"><strong>Boosting Trees</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id24"><strong>Random Forest</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-gradient-boosting"><strong>Histogram gradient Boosting</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost"><strong>XGBoost</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-svm"><strong>Linear SVM</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-layer-perceptron"><strong>Multi-Layer Perceptron</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id25"><strong>Stacking</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-the-best-model"><strong>Selecting the best model</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#best-pipeline-hyper-parameters"><strong>Best pipeline hyper-parameters</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#features-selected"><strong>Features selected</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-analysis"><strong>Predictive analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-plots"><strong>Predictive plots</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-intervals"><strong>Prediction Intervals</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inference"><strong>Inference</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-of-the-best-linear-regression-model"><strong>Coefficient interpretation of the best Linear Regression model</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-importance-analysis-with-the-best-penalized-linear-regression-model"><strong>Predictors importance analysis with the best Penalized Linear Regression model</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="body-fat-prediction-with-machine-learning">
<h1><strong>Body Fat Prediction with Machine Learning</strong><a class="headerlink" href="#body-fat-prediction-with-machine-learning" title="Link to this heading">#</a></h1>
<section id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="c1"># Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="c1"># Discretize</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">KBinsDiscretizer</span>
<span class="c1"># Imputers</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>
<span class="c1"># Scalers</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="c1"># Features Selectors</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectFdr</span><span class="p">,</span> <span class="n">SelectFpr</span><span class="p">,</span> <span class="n">f_regression</span><span class="p">,</span> <span class="n">SequentialFeatureSelector</span>
<span class="c1"># Models</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">HistGradientBoostingRegressor</span><span class="p">,</span> <span class="n">BaggingRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span><span class="p">,</span> <span class="n">ExtraTreesRegressor</span><span class="p">,</span> <span class="n">StackingRegressor</span>
<span class="kn">from</span>  <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVR</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="c1"># Evaluation and HPO</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">RandomizedSearchCV</span><span class="p">,</span> <span class="n">PredefinedSplit</span><span class="p">,</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">import</span> <span class="nn">optuna</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;C:/Users/fscielzo/Documents/DataScience-GitHub/EDA&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">EDA</span> <span class="kn">import</span> <span class="n">dtypes_df</span><span class="p">,</span> <span class="n">prop_cols_nulls</span><span class="p">,</span> <span class="n">corr_matrix</span><span class="p">,</span> <span class="n">outliers_table</span><span class="p">,</span>  <span class="n">scatter_matrix</span><span class="p">,</span> <span class="n">quant_to_cat</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">freq_table</span><span class="p">,</span> <span class="n">boxplot</span><span class="p">,</span> <span class="n">ecdfplot</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OptunaSearchCV</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">n_iter</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>

    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
 
       <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">))</span>
       <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="p">))</span>
       <span class="k">return</span> <span class="n">score</span> 
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
       
       <span class="n">sampler</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
       <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span> <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span>  <span class="k">else</span> <span class="s1">&#39;minimize&#39;</span>
       <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
       <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span><span class="p">)</span> 
       <span class="bp">self</span><span class="o">.</span><span class="n">best_params_</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">best_score_</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_value</span> 
       <span class="bp">self</span><span class="o">.</span><span class="n">study</span> <span class="o">=</span> <span class="n">study</span>

    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="c1"># Collect trial information</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">study</span><span class="o">.</span><span class="n">trials</span><span class="p">:</span>
            <span class="n">trial_data</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
              <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
              <span class="p">}</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial_data</span><span class="p">)</span>

        <span class="c1"># Create a DataFrame from the collected information</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">optuna_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">inner_results</span><span class="p">,</span> <span class="n">outer_scores</span><span class="p">,</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">):</span>

    <span class="c1"># Inner results (HPO)</span>
    <span class="n">inner_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>
    <span class="c1"># Outer score (estimation future performance)</span>
    <span class="n">best_estimator</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">best_estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
    <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">best_estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scoring</span> <span class="o">==</span> <span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">:</span>
        <span class="n">outer_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">scoring</span> <span class="o">==</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">:</span>
        <span class="n">outer_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">))</span>   

    <span class="k">return</span> <span class="n">inner_results</span><span class="p">,</span> <span class="n">outer_scores</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simple_validation</span><span class="p">(</span><span class="n">data_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span><span class="p">]:</span>
        <span class="n">train_size</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">train_prop</span><span class="o">*</span><span class="n">data_size</span><span class="p">)</span>
        <span class="n">test_size</span> <span class="o">=</span> <span class="n">data_size</span> <span class="o">-</span> <span class="n">train_size</span>
        <span class="n">train_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_size</span><span class="p">)</span> <span class="c1"># -1 = Train </span>
        <span class="n">test_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">test_size</span><span class="p">)</span>  <span class="c1"># 0 = Test</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">random</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_indices</span><span class="p">)</span> <span class="p">;</span> <span class="n">test_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_indices</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">test_size</span><span class="p">)</span>
        <span class="n">indices</span><span class="p">[</span><span class="n">train_indices</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    
    <span class="k">return</span> <span class="n">PredefinedSplit</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examples of usage</span>
<span class="c1"># simple_validation(data_size=len(X_train), train_prop=0.75, random=True, random_state=123)</span>
<span class="c1"># simple_validation(data_size=len(X), train_prop=0.75, random=False)</span>
<span class="c1"># simple_validation(train_indices=[0,2,3,5,10], test_indices=[1,4,6,7,8,9])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">format_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">scoring</span><span class="p">):</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
    <span class="n">columns_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">columns_to_keep</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="n">scoring</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="o">-</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rename_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns_to_keep</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns_to_keep</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]]</span>
    <span class="n">rename_columns</span> <span class="o">=</span> <span class="n">rename_columns</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">rename_columns</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleEvaluation</span><span class="p">:</span> <span class="c1"># Outer: Simple Validation ; Inner: Simple or CV</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">search_method</span><span class="p">,</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">):</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">inner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">=</span> <span class="n">search_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span> <span class="o">=</span> <span class="n">n_trials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
            
        <span class="c1"># Inner HPO</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;optuna&#39;</span><span class="p">:</span>

            <span class="n">search</span> <span class="o">=</span> <span class="n">OptunaSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span>       
                                    <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> 
                                    <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;random_search&#39;</span><span class="p">:</span>              
                <span class="n">search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                                            <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> 
                                            <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;grid_search&#39;</span><span class="p">:</span>              

                <span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                                      <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">)</span>          
            
        <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="c1"># Inner results (HPO)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_results</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">results</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;optuna&#39;</span> <span class="k">else</span> <span class="n">format_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">)</span>

        <span class="c1"># Inner results (HPO)    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_best_params</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">best_params_</span>
        <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner_score</span> <span class="o">=</span> <span class="o">-</span> <span class="n">search</span><span class="o">.</span><span class="n">best_score_</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner_score</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">best_score_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NestedEvaluation</span><span class="p">:</span> <span class="c1"># Outer: CV ; Inner: CV</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span>  <span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="p">,</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">):</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">inner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">=</span> <span class="n">search_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span> <span class="o">=</span> <span class="n">n_trials</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>      

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>

        <span class="n">inner_scores</span><span class="p">,</span> <span class="n">outer_scores</span><span class="p">,</span> <span class="n">inner_best_params</span><span class="p">,</span> <span class="n">inner_results</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="p">:</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Outer: Fold </span><span class="si">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
            <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">inner_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">))</span>
                <span class="n">inner_score</span> <span class="o">=</span> <span class="o">-</span><span class="n">inner_score</span> <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="k">else</span> <span class="n">inner_score</span>
                <span class="n">inner_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_score</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
                <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">==</span> <span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">:</span>
                    <span class="n">outer_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">==</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">:</span>
                    <span class="n">outer_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">))</span> 

            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Inner HPO</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;optuna&#39;</span><span class="p">:</span>

                    <span class="n">search</span> <span class="o">=</span> <span class="n">OptunaSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                        <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
                    <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
                    
                    <span class="n">inner_results</span><span class="p">,</span> <span class="n">outer_scores</span> <span class="o">=</span> <span class="n">optuna_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">inner_results</span><span class="p">,</span> <span class="n">outer_scores</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;random_search&#39;</span><span class="p">:</span>
                
                        <span class="n">search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                                <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
                        <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;grid_search&#39;</span><span class="p">:</span>              

                        <span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                                                <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">)</span>  
                    
                    <span class="c1"># Inner results (HPO)</span>
                    <span class="n">inner_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">))</span>
                    <span class="c1"># Outer score (estimation future performance)</span>
                    <span class="n">outer_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_test</span><span class="p">))</span>                   
            
                <span class="c1"># Inner (HPO) best_params and score</span>
                <span class="n">inner_best_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
                <span class="n">inner_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="k">else</span> <span class="n">inner_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inner_results</span> <span class="o">=</span> <span class="n">inner_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_best_params</span> <span class="o">=</span> <span class="n">inner_best_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outer_scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inner_scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_inner_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_outer_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_scores</span><span class="p">)</span> <span class="c1"># Estimation of future performance</span>
        <span class="c1"># The one with the least MAE. This is a criteria to obtain the finals params, but not the only possible.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_best_params</span> <span class="o">=</span> <span class="n">inner_best_params</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_scores</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SemiNestedEvaluation</span><span class="p">:</span> <span class="c1"># Outer: CV ; Inner: Simple</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">outer</span><span class="p">,</span> <span class="n">search_method</span><span class="p">,</span> <span class="n">scoring</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                 <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">train_prop</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">random_sv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">train_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span> <span class="o">=</span> <span class="n">param_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">=</span> <span class="n">search_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span> <span class="o">=</span> <span class="n">n_trials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_prop</span> <span class="o">=</span> <span class="n">train_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_sv</span> <span class="o">=</span> <span class="n">random_sv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span> <span class="o">=</span> <span class="n">train_indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span> <span class="o">=</span> <span class="n">test_indices</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>

        <span class="n">inner_scores</span><span class="p">,</span> <span class="n">outer_scores</span><span class="p">,</span> <span class="n">inner_best_params</span><span class="p">,</span> <span class="n">inner_results</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="p">:</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Outer: Fold </span><span class="si">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_index</span><span class="p">,:],</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span><span class="p">,:]</span>
            <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>

            <span class="c1"># Inner definition (differential step)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">simple_validation</span><span class="p">(</span><span class="n">data_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">train_prop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_prop</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_sv</span><span class="p">,</span> 
                                    <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span> <span class="n">train_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">test_indices</span><span class="p">)</span>
            <span class="c1"># Inner HPO</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;optuna&#39;</span><span class="p">:</span>

                <span class="n">search</span> <span class="o">=</span> <span class="n">OptunaSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                    <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
                <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
                
                <span class="n">inner_results</span><span class="p">,</span> <span class="n">outer_scores</span> <span class="o">=</span> <span class="n">optuna_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">inner_results</span><span class="p">,</span> <span class="n">outer_scores</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;random_search&#39;</span><span class="p">:</span>
            
                    <span class="n">search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                            <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">)</span>
                    <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_method</span> <span class="o">==</span> <span class="s1">&#39;grid_search&#39;</span><span class="p">:</span>              

                    <span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param_grid</span><span class="p">,</span> 
                                            <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">)</span>  
                
                <span class="c1"># Inner results (HPO)</span>
                <span class="n">inner_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_results</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span><span class="p">))</span>
                <span class="c1"># Outer score (estimation future performance)</span>
                <span class="n">outer_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_test</span><span class="p">))</span>                   
        
            <span class="c1"># Inner (HPO) best_params and score</span>
            <span class="n">inner_best_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
            <span class="n">inner_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="k">else</span> <span class="n">inner_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inner_results</span> <span class="o">=</span> <span class="n">inner_results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_best_params</span> <span class="o">=</span> <span class="n">inner_best_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outer_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outer_scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inner_scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_inner_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_scores</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_outer_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_scores</span><span class="p">)</span> <span class="c1"># Estimation of future performance</span>
        <span class="c1"># The one with the least MAE. This is a criteria to obtain the finals params, but not the only possible.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_best_params</span> <span class="o">=</span> <span class="n">inner_best_params</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_scores</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">imputer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;not_impute&#39;</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_nearest_features</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="n">n_neighbors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_nearest_features</span> <span class="o">=</span> <span class="n">n_nearest_features</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;not_impute&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;simple_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;simple_median&#39;</span><span class="p">,</span> <span class="s1">&#39;simple_most_frequent&#39;</span><span class="p">]:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">imputer_</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;knn&#39;</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">imputer_</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;iterative_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_median&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_most_frequent&#39;</span><span class="p">]:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">imputer_</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">initial_strategy</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]),</span> 
                                                  <span class="n">n_nearest_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nearest_features</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid method for imputation&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imputer_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;not_impute&#39;</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imputer_</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># Output: numpy array</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">scaler</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">=</span> <span class="n">apply</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaler_</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaler_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler_</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">discretizer</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;quantile&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">=</span> <span class="n">apply</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span> <span class="o">=</span> <span class="n">n_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">strategy</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">discretizer_</span> <span class="o">=</span> <span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">encode</span><span class="o">=</span><span class="s1">&#39;ordinal&#39;</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">discretizer_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discretizer_</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">features_selector</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Fdr&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;not_select&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Fdr&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="n">SelectFdr</span><span class="p">(</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Fpr&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="n">SelectFpr</span><span class="p">(</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;forward_linear_regression&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">LinearRegression</span><span class="p">(),</span>
                                                                <span class="n">n_features_to_select</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                                <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;backward_linear_regression&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">LinearRegression</span><span class="p">(),</span>
                                                                <span class="n">n_features_to_select</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                                <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;forward_knn&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                                                                <span class="n">n_features_to_select</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                                <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;backward_knn&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                                                                <span class="n">n_features_to_select</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                                <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid method for features selector&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;not_select&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;not_select&#39;</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_selector_</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predictive_plots</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y_hat</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">future_performance</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># Calculate residuals and percentage deviation</span>
    <span class="n">percentage_deviation</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="n">Y_hat</span><span class="p">)</span> <span class="o">/</span> <span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="c1"># Create an array of x-axis values</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot 1: True values vs. Predicted values</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Y_hat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted vs True&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">},</span> 
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Perfect Fit&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted vs True Values - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">text_x</span> <span class="o">=</span> <span class="mf">0.50</span>  <span class="c1"># X position of the text in figure coordinate (0 to 1)</span>
    <span class="n">text_y</span> <span class="o">=</span> <span class="mf">0.07</span>  <span class="c1"># Y position of the text in figure coordinate (0 to 1)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Estimation of future performance (MAE) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">future_performance</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                 <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="c1"># Plot 2: Percentage Deviation of Prediction</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Y_hat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">percentage_deviation</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Set y-axis limits</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Percentage Deviation (%)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Percentage Deviation of Prediction - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">text_x</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># X position of the text in figure coordinate (0 to 1)</span>
    <span class="n">text_y</span> <span class="o">=</span> <span class="mf">0.95</span>  <span class="c1"># Y position of the text in figure coordinate (0 to 1)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">text_x</span><span class="p">,</span> <span class="n">text_y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Deviation Percentage of prediction from real values (on average) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">percentage_deviation</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">,</span> 
                 <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    
    <span class="c1"># Create a new figure for the fourth plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot 3: Line plot of True vs. Predicted values</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_hat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True vs Predicted Values - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Create a new figure for the fourth plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot 4: Line plot of True vs. Predicted values</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
    <span class="n">x_values_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values_random</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">x_values_random</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values_random</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_hat</span><span class="p">[</span><span class="n">x_values_random</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True vs Predicted Values (100 random data indices I)  - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Create a new figure for the fourth plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot 4: Line plot of True vs. Predicted values</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">x_values_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values_random</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">x_values_random</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_values_random</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_hat</span><span class="p">[</span><span class="n">x_values_random</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True vs. Predicted Values (100 random indices II)  - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-problem">
<h2><strong>The problem</strong><a class="headerlink" href="#the-problem" title="Link to this heading">#</a></h2>
<p>The percentage of body fat of an individual can be estimated once body density has been determined (Siri, 1956), assuming that body is made up with two components:</p>
<ul class="simple">
<li><p>Lean body tissue (tejido magro)</p></li>
<li><p>Fat tissue (tejido graso)</p></li>
</ul>
<p>Letting:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(D:=\)</span> body density <span class="math notranslate nohighlight">\((g/cm^3)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(A:=\)</span> proportion of lean body tissue</p></li>
<li><p><span class="math notranslate nohighlight">\(B:=\)</span> proportion of fat tissue <span class="math notranslate nohighlight">\(= 1-A\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(a:=\)</span> density of lean body tissue <span class="math notranslate nohighlight">\((g/cm^3)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(b:=\)</span> density of fat tissue <span class="math notranslate nohighlight">\((g/cm^3)\)</span></p>
<div class="math notranslate nohighlight">
\[D= \dfrac{1}{A/a + B/b}\]</div>
</li>
</ul>
<p>Solving for <span class="math notranslate nohighlight">\(B\)</span> we have:</p>
<div class="math notranslate nohighlight">
\[B=\dfrac{a\cdot b/D - b}{a- b}\]</div>
<p>Using the estimations <span class="math notranslate nohighlight">\(a=1.10\hspace{0.1cm} g/cm^3\)</span> and <span class="math notranslate nohighlight">\(b=0.9 \hspace{0.1cm}g/cm^3\)</span> (Katch and McArde (1977) and Wilmore (1976)), we come up with the Siri’s equation:</p>
<ul>
<li><p>Proportion of fat tissue (body fat):</p>
<div class="math notranslate nohighlight">
\[B=(495/D -450)\cdot(1/100)\]</div>
</li>
<li><p>Percentage of fat tissue (body fat):</p>
<div class="math notranslate nohighlight">
\[B=495/D -450\]</div>
</li>
</ul>
<p>How to compute body density (D)?</p>
<p>Following to Katch and McArdle (1977), the technique of underwater weighing computes body density as the difference between body weight measured in air and weight measured during water submersion.</p>
<p>In other words, body density is equal to loss of weight in water with the appropriate temperature correction for water’s density.</p>
<p>Using this technique, the body density can be compute as:</p>
<div class="math notranslate nohighlight">
\[D = \dfrac{WA}{(WA-WW)\cdot CF - LV}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(WA :=\)</span> weight in air <span class="math notranslate nohighlight">\((kg)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(WW:=\)</span> weight in water <span class="math notranslate nohighlight">\((kg)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(CF :=\)</span> water correction factor</p></li>
<li><p><span class="math notranslate nohighlight">\(LV:=\)</span> residual lung volume (liters)</p></li>
</ul>
<p><strong>Goal and motivation:</strong></p>
<p>Estimate the percentage of body fat according to Siri’s equation  <span class="math notranslate nohighlight">\(B = f(D)=495/D -450\)</span>  without using <span class="math notranslate nohighlight">\(D\)</span>, since in practice is very expensive to compute the body density.</p>
<p>The idea is to use a statistical or Machine Learning model to estimate (predict) the percentage of body fat of individuals without the need of computing the body density, which is expensive.</p>
</section>
<section id="conceptual-description-of-the-data">
<h2><strong>Conceptual description of the data</strong><a class="headerlink" href="#conceptual-description-of-the-data" title="Link to this heading">#</a></h2>
<p>The data set of this project has been extracted from <code class="docutils literal notranslate"><span class="pre">Kaggle</span></code>: <a class="reference external" href="https://www.kaggle.com/datasets/fedesoriano/body-fat-prediction-dataset">https://www.kaggle.com/datasets/fedesoriano/body-fat-prediction-dataset</a></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Density</span></code></p></td>
<td><p>Body density determined from underwater weighing</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">BodyFat</span></code></p></td>
<td><p>Percent body fat from Siri’s (1956) equation</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Age</span></code></p></td>
<td><p>Age (years)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Weight</span></code></p></td>
<td><p>Weight (lbs)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Height</span></code></p></td>
<td><p>Height (inches)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Neck</span></code></p></td>
<td><p>Neck circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Chest</span></code></p></td>
<td><p>Chest circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Abdomen</span></code></p></td>
<td><p>Abdomen 2 circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Hip</span></code></p></td>
<td><p>Hip circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Thigh</span></code></p></td>
<td><p>Thigh circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Knee</span></code></p></td>
<td><p>Knee circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ankle</span></code></p></td>
<td><p>Ankle circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Biceps</span></code></p></td>
<td><p>Biceps (extended) circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Forearm</span></code></p></td>
<td><p>Forearm circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Wrist</span></code></p></td>
<td><p>Wrist circumference (cm)</p></td>
<td><p>Quantitative</p></td>
</tr>
</tbody>
</table>
<p>We have apply two previous transformations on the data.</p>
<ul class="simple">
<li><p>Data augmentation: we have applied a data augmentation technique, contained in the file <code class="docutils literal notranslate"><span class="pre">Data_Augmentation.ipynb</span></code> which the aim of make the data bigger making so the project more realistic and complex (specially computationally). The original size of the data was <span class="math notranslate nohighlight">\(n=253\)</span> and the size of our augmented version is <span class="math notranslate nohighlight">\(n=6300\)</span>. As can be seen in the cited file, the applied data augmentation technique preserve the original data distribution.</p></li>
<li><p>Missing values contamination: we have include missing values on the data artificially, again, to make the project more challenging an realistic.</p></li>
</ul>
<p>The <strong>response variable</strong> of the project will be <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code>, and the predictors will be the rest, except <code class="docutils literal notranslate"><span class="pre">Density</span></code>, which will not be used, since our aim is to predict <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> without the need of using <code class="docutils literal notranslate"><span class="pre">Density</span></code>, as was explained before.</p>
</section>
<section id="eda">
<h2><strong>EDA</strong><a class="headerlink" href="#eda" title="Link to this heading">#</a></h2>
<section id="reading-the-data">
<h3><strong>Reading the data</strong><a class="headerlink" href="#reading-the-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bodyfat_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;bodyfat_NaNs.csv&#39;</span><span class="p">)</span>
<span class="n">bodyfat_df</span> <span class="o">=</span> <span class="n">bodyfat_df</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="n">bodyfat_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 15)</small><table border="1" class="dataframe"><thead><tr><th>Density</th><th>BodyFat</th><th>Age</th><th>Weight</th><th>Height</th><th>Neck</th><th>Chest</th><th>Abdomen</th><th>Hip</th><th>Thigh</th><th>Knee</th><th>Ankle</th><th>Biceps</th><th>Forearm</th><th>Wrist</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>1.0708</td><td>12.3</td><td>23.0</td><td>null</td><td>67.75</td><td>36.2</td><td>93.1</td><td>85.2</td><td>94.5</td><td>59.0</td><td>37.3</td><td>21.9</td><td>32.0</td><td>27.4</td><td>17.1</td></tr><tr><td>1.0853</td><td>6.1</td><td>22.0</td><td>173.25</td><td>72.25</td><td>38.5</td><td>null</td><td>83.0</td><td>98.7</td><td>58.7</td><td>37.3</td><td>23.4</td><td>30.5</td><td>28.9</td><td>18.2</td></tr><tr><td>1.0414</td><td>25.3</td><td>22.0</td><td>154.0</td><td>66.25</td><td>34.0</td><td>95.8</td><td>87.9</td><td>99.2</td><td>59.6</td><td>38.9</td><td>24.0</td><td>28.8</td><td>25.2</td><td>16.6</td></tr><tr><td>1.0751</td><td>10.4</td><td>26.0</td><td>184.75</td><td>72.25</td><td>37.4</td><td>101.8</td><td>86.4</td><td>101.2</td><td>60.1</td><td>37.3</td><td>22.8</td><td>32.4</td><td>29.4</td><td>18.2</td></tr><tr><td>1.034</td><td>28.7</td><td>24.0</td><td>184.25</td><td>71.25</td><td>34.4</td><td>97.3</td><td>100.0</td><td>101.9</td><td>63.2</td><td>42.2</td><td>24.0</td><td>32.2</td><td>27.7</td><td>17.7</td></tr><tr><td>1.0502</td><td>20.9</td><td>24.0</td><td>210.25</td><td>74.75</td><td>39.0</td><td>104.5</td><td>94.4</td><td>107.8</td><td>66.0</td><td>42.0</td><td>25.6</td><td>35.7</td><td>30.6</td><td>18.8</td></tr><tr><td>1.0549</td><td>19.2</td><td>26.0</td><td>181.0</td><td>69.75</td><td>36.4</td><td>105.1</td><td>90.7</td><td>100.3</td><td>58.4</td><td>38.3</td><td>22.9</td><td>31.9</td><td>27.8</td><td>17.7</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="dimensions">
<h3><strong>Dimensions</strong><a class="headerlink" href="#dimensions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bodyfat_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6300, 15)
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-types">
<h3><strong>Data types</strong><a class="headerlink" href="#data-types" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dtypes_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 2)</small><table border="1" class="dataframe"><thead><tr><th>Columns</th><th>Python_type</th></tr><tr><td>str</td><td>object</td></tr></thead><tbody><tr><td>&quot;Density&quot;</td><td>Float64</td></tr><tr><td>&quot;BodyFat&quot;</td><td>Float64</td></tr><tr><td>&quot;Age&quot;</td><td>Float64</td></tr><tr><td>&quot;Weight&quot;</td><td>Float64</td></tr><tr><td>&quot;Height&quot;</td><td>Float64</td></tr><tr><td>&quot;Neck&quot;</td><td>Float64</td></tr><tr><td>&quot;Chest&quot;</td><td>Float64</td></tr><tr><td>&quot;Abdomen&quot;</td><td>Float64</td></tr><tr><td>&quot;Hip&quot;</td><td>Float64</td></tr><tr><td>&quot;Thigh&quot;</td><td>Float64</td></tr><tr><td>&quot;Knee&quot;</td><td>Float64</td></tr><tr><td>&quot;Ankle&quot;</td><td>Float64</td></tr><tr><td>&quot;Biceps&quot;</td><td>Float64</td></tr><tr><td>&quot;Forearm&quot;</td><td>Float64</td></tr><tr><td>&quot;Wrist&quot;</td><td>Float64</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="unique-values">
<h3><strong>Unique values</strong><a class="headerlink" href="#unique-values" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of unique values:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">bodyfat_df</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bodyfat_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of unique values:
Density : 2690
BodyFat : 4179
Age : 52
Weight : 3803
Height : 4040
Neck : 4081
Chest : 3770
Abdomen : 4104
Hip : 4152
Thigh : 4139
Knee : 3949
Ankle : 4023
Biceps : 4099
Forearm : 4057
Wrist : 4011
</pre></div>
</div>
</div>
</div>
</section>
<section id="missing-values">
<h3><strong>Missing values</strong><a class="headerlink" href="#missing-values" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prop_cols_nulls</span><span class="p">(</span><span class="n">bodyfat_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 15)</small><table border="1" class="dataframe"><thead><tr><th>Density</th><th>BodyFat</th><th>Age</th><th>Weight</th><th>Height</th><th>Neck</th><th>Chest</th><th>Abdomen</th><th>Hip</th><th>Thigh</th><th>Knee</th><th>Ankle</th><th>Biceps</th><th>Forearm</th><th>Wrist</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>0.0</td><td>0.028413</td><td>0.13254</td><td>0.0</td><td>0.0</td><td>0.136508</td><td>0.028254</td><td>0.0</td><td>0.0</td><td>0.042381</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="descriptive-summary">
<h3><strong>Descriptive summary</strong><a class="headerlink" href="#descriptive-summary" title="Link to this heading">#</a></h3>
<p>In this data-set we only have quantitative variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Density&#39;</span><span class="p">,</span> <span class="s1">&#39;BodyFat&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Weight&#39;</span><span class="p">,</span>	<span class="s1">&#39;Height&#39;</span><span class="p">,</span> <span class="s1">&#39;Neck&#39;</span><span class="p">,</span> <span class="s1">&#39;Chest&#39;</span><span class="p">,</span> <span class="s1">&#39;Abdomen&#39;</span><span class="p">,</span> <span class="s1">&#39;Hip&#39;</span><span class="p">,</span> <span class="s1">&#39;Thigh&#39;</span><span class="p">,</span> <span class="s1">&#39;Knee&#39;</span><span class="p">,</span> <span class="s1">&#39;Ankle&#39;</span><span class="p">,</span> <span class="s1">&#39;Biceps&#39;</span><span class="p">,</span> <span class="s1">&#39;Forearm&#39;</span><span class="p">,</span> <span class="s1">&#39;Wrist&#39;</span><span class="p">]</span>
<span class="n">cat_columns</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span><span class="p">,</span> <span class="n">cat_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">,</span> <span class="n">auto_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">quant_col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">,</span>
                                     <span class="n">cat_col_names</span><span class="o">=</span><span class="n">cat_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Density</th>
      <th>BodyFat</th>
      <th>Age</th>
      <th>Weight</th>
      <th>Height</th>
      <th>Neck</th>
      <th>Chest</th>
      <th>Abdomen</th>
      <th>Hip</th>
      <th>Thigh</th>
      <th>Knee</th>
      <th>Ankle</th>
      <th>Biceps</th>
      <th>Forearm</th>
      <th>Wrist</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_unique</th>
      <td>2690</td>
      <td>4179</td>
      <td>52</td>
      <td>3803</td>
      <td>4040</td>
      <td>4081</td>
      <td>3770</td>
      <td>4104</td>
      <td>4152</td>
      <td>4139</td>
      <td>3949</td>
      <td>4023</td>
      <td>4099</td>
      <td>4057</td>
      <td>4011</td>
    </tr>
    <tr>
      <th>prop_nan</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.028413</td>
      <td>0.13254</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.136508</td>
      <td>0.028254</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.042381</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.046927</td>
      <td>15.791546</td>
      <td>44.525894</td>
      <td>177.039234</td>
      <td>68.6489</td>
      <td>39.037624</td>
      <td>97.619934</td>
      <td>92.412989</td>
      <td>98.691088</td>
      <td>60.977981</td>
      <td>37.650698</td>
      <td>22.631281</td>
      <td>31.526835</td>
      <td>27.906424</td>
      <td>17.433879</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.01712</td>
      <td>7.029513</td>
      <td>12.019294</td>
      <td>26.258694</td>
      <td>2.450099</td>
      <td>1.929436</td>
      <td>7.132737</td>
      <td>9.770998</td>
      <td>5.861167</td>
      <td>4.768741</td>
      <td>1.883434</td>
      <td>1.029156</td>
      <td>2.534028</td>
      <td>1.525864</td>
      <td>0.709502</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.995</td>
      <td>0.0</td>
      <td>22.0</td>
      <td>118.5</td>
      <td>29.5</td>
      <td>31.1</td>
      <td>79.3</td>
      <td>69.4</td>
      <td>85.0</td>
      <td>47.2</td>
      <td>33.0</td>
      <td>19.1</td>
      <td>24.8</td>
      <td>21.0</td>
      <td>15.54406</td>
    </tr>
    <tr>
      <th>Q10</th>
      <td>1.02421</td>
      <td>6.13537</td>
      <td>28.0</td>
      <td>145.69718</td>
      <td>66.49189</td>
      <td>36.75796</td>
      <td>89.38699</td>
      <td>80.70067</td>
      <td>91.36823</td>
      <td>55.23648</td>
      <td>35.00227</td>
      <td>21.37898</td>
      <td>28.59613</td>
      <td>26.28786</td>
      <td>16.53461</td>
    </tr>
    <tr>
      <th>Q25</th>
      <td>1.03457</td>
      <td>10.16354</td>
      <td>36.0</td>
      <td>157.45556</td>
      <td>67.22314</td>
      <td>37.67701</td>
      <td>91.9672</td>
      <td>85.65571</td>
      <td>94.25927</td>
      <td>57.93784</td>
      <td>36.52834</td>
      <td>22.08417</td>
      <td>29.9</td>
      <td>26.86559</td>
      <td>16.96946</td>
    </tr>
    <tr>
      <th>median</th>
      <td>1.044555</td>
      <td>16.986875</td>
      <td>43.0</td>
      <td>175.54596</td>
      <td>68.12617</td>
      <td>38.818415</td>
      <td>97.24016</td>
      <td>91.29019</td>
      <td>98.57061</td>
      <td>60.59867</td>
      <td>37.90054</td>
      <td>22.52551</td>
      <td>31.3</td>
      <td>27.783135</td>
      <td>17.44799</td>
    </tr>
    <tr>
      <th>Q75</th>
      <td>1.06268</td>
      <td>20.50853</td>
      <td>54.0</td>
      <td>194.70672</td>
      <td>70.26203</td>
      <td>40.74968</td>
      <td>102.35255</td>
      <td>98.80395</td>
      <td>101.43882</td>
      <td>63.11212</td>
      <td>38.73637</td>
      <td>23.14611</td>
      <td>32.9668</td>
      <td>29.14935</td>
      <td>17.95077</td>
    </tr>
    <tr>
      <th>Q90</th>
      <td>1.06854</td>
      <td>25.24774</td>
      <td>62.0</td>
      <td>214.10425</td>
      <td>71.5</td>
      <td>41.43373</td>
      <td>107.63316</td>
      <td>105.73317</td>
      <td>106.8519</td>
      <td>68.16239</td>
      <td>40.20351</td>
      <td>24.02729</td>
      <td>35.36395</td>
      <td>29.75838</td>
      <td>18.29931</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.1089</td>
      <td>47.5</td>
      <td>81.0</td>
      <td>363.15</td>
      <td>77.75</td>
      <td>51.2</td>
      <td>128.3</td>
      <td>148.1</td>
      <td>147.7</td>
      <td>87.3</td>
      <td>49.1</td>
      <td>33.9</td>
      <td>45.0</td>
      <td>34.9</td>
      <td>21.4</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>2.288703</td>
      <td>2.327965</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>39.741124</td>
      <td>3.83455</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.312113</td>
      <td>3.602011</td>
      <td>NaN</td>
      <td>12.15393</td>
      <td>2.863798</td>
      <td>3.553162</td>
      <td>3.967574</td>
    </tr>
    <tr>
      <th>skew</th>
      <td>-0.070792</td>
      <td>-0.017434</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-3.005596</td>
      <td>0.286104</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.510108</td>
      <td>0.480555</td>
      <td>NaN</td>
      <td>1.104484</td>
      <td>0.221744</td>
      <td>-0.285386</td>
      <td>0.174633</td>
    </tr>
    <tr>
      <th>n_outliers</th>
      <td>2</td>
      <td>6</td>
      <td>0</td>
      <td>12</td>
      <td>42</td>
      <td>33</td>
      <td>15</td>
      <td>26</td>
      <td>60</td>
      <td>179</td>
      <td>41</td>
      <td>209</td>
      <td>14</td>
      <td>44</td>
      <td>40</td>
    </tr>
    <tr>
      <th>n_not_outliers</th>
      <td>6298</td>
      <td>6294</td>
      <td>6300</td>
      <td>6288</td>
      <td>6258</td>
      <td>6267</td>
      <td>6285</td>
      <td>6274</td>
      <td>6240</td>
      <td>6121</td>
      <td>6259</td>
      <td>6091</td>
      <td>6286</td>
      <td>6256</td>
      <td>6260</td>
    </tr>
    <tr>
      <th>prop_outliers</th>
      <td>0.000317</td>
      <td>0.000952</td>
      <td>0.0</td>
      <td>0.001905</td>
      <td>0.006667</td>
      <td>0.005238</td>
      <td>0.002381</td>
      <td>0.004127</td>
      <td>0.009524</td>
      <td>0.028413</td>
      <td>0.006508</td>
      <td>0.033175</td>
      <td>0.002222</td>
      <td>0.006984</td>
      <td>0.006349</td>
    </tr>
    <tr>
      <th>prop_not_outliers</th>
      <td>0.999683</td>
      <td>0.999048</td>
      <td>1.0</td>
      <td>0.998095</td>
      <td>0.993333</td>
      <td>0.994762</td>
      <td>0.997619</td>
      <td>0.995873</td>
      <td>0.990476</td>
      <td>0.971587</td>
      <td>0.993492</td>
      <td>0.966825</td>
      <td>0.997778</td>
      <td>0.993016</td>
      <td>0.993651</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="outliers">
<h3><strong>Outliers</strong><a class="headerlink" href="#outliers" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers_table</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 7)</small><table border="1" class="dataframe"><thead><tr><th>quant_variables</th><th>lower_bound</th><th>upper_bound</th><th>n_outliers</th><th>n_not_outliers</th><th>prop_outliers</th><th>prop_not_outliers</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;Density&quot;</td><td>0.992405</td><td>1.104845</td><td>2</td><td>6298</td><td>0.000317</td><td>0.999683</td></tr><tr><td>&quot;BodyFat&quot;</td><td>-5.353945</td><td>36.026015</td><td>6</td><td>6294</td><td>0.000952</td><td>0.999048</td></tr><tr><td>&quot;Age&quot;</td><td>9.0</td><td>81.0</td><td>0</td><td>6121</td><td>0.0</td><td>1.0</td></tr><tr><td>&quot;Weight&quot;</td><td>101.57882</td><td>250.58346</td><td>12</td><td>5453</td><td>0.002196</td><td>0.997804</td></tr><tr><td>&quot;Height&quot;</td><td>62.664805</td><td>74.820365</td><td>42</td><td>6258</td><td>0.006667</td><td>0.993333</td></tr><tr><td>&quot;Neck&quot;</td><td>33.068005</td><td>45.358685</td><td>33</td><td>6267</td><td>0.005238</td><td>0.994762</td></tr><tr><td>&quot;Chest&quot;</td><td>76.389175</td><td>117.930575</td><td>15</td><td>5425</td><td>0.002757</td><td>0.997243</td></tr><tr><td>&quot;Abdomen&quot;</td><td>65.93335</td><td>118.52631</td><td>26</td><td>6096</td><td>0.004247</td><td>0.995753</td></tr><tr><td>&quot;Hip&quot;</td><td>83.489945</td><td>112.208145</td><td>60</td><td>6240</td><td>0.009524</td><td>0.990476</td></tr><tr><td>&quot;Thigh&quot;</td><td>50.17642</td><td>70.87354</td><td>179</td><td>6121</td><td>0.028413</td><td>0.971587</td></tr><tr><td>&quot;Knee&quot;</td><td>33.216295</td><td>42.048415</td><td>41</td><td>5992</td><td>0.006796</td><td>0.993204</td></tr><tr><td>&quot;Ankle&quot;</td><td>20.49126</td><td>24.73902</td><td>209</td><td>6091</td><td>0.033175</td><td>0.966825</td></tr><tr><td>&quot;Biceps&quot;</td><td>25.2998</td><td>37.567</td><td>14</td><td>6286</td><td>0.002222</td><td>0.997778</td></tr><tr><td>&quot;Forearm&quot;</td><td>23.43995</td><td>32.57499</td><td>44</td><td>6256</td><td>0.006984</td><td>0.993016</td></tr><tr><td>&quot;Wrist&quot;</td><td>15.497495</td><td>19.422735</td><td>40</td><td>6260</td><td>0.006349</td><td>0.993651</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="response-analysis">
<h3><strong>Response analysis</strong><a class="headerlink" href="#response-analysis" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;BodyFat&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="histogram">
<h4><strong>Histogram</strong><a class="headerlink" href="#histogram" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6d92ad56ddb7dce73a8cbe6175d7eb5f5d9d5b540dbc0583e85f86355ed3cf92.png" src="_images/6d92ad56ddb7dce73a8cbe6175d7eb5f5d9d5b540dbc0583e85f86355ed3cf92.png" />
</div>
</div>
</section>
<section id="frequencies">
<h4><strong>Frequencies</strong><a class="headerlink" href="#frequencies" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_cat</span> <span class="o">=</span> <span class="n">quant_to_cat</span><span class="p">(</span><span class="n">bodyfat_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;quartiles&#39;</span><span class="p">,</span> <span class="n">n_intervals</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freq_table</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">response_cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>BodyFat: unique values</th><th>abs_freq</th><th>rel_freq</th><th>cum_abs_freq</th><th>cum_rel_freq</th></tr><tr><td>object</td><td>i64</td><td>f64</td><td>i64</td><td>f64</td></tr></thead><tbody><tr><td>(-inf, 0]</td><td>2</td><td>0.0003</td><td>2</td><td>0.000317</td></tr><tr><td>(0, 10.1635]</td><td>1573</td><td>0.2497</td><td>1575</td><td>0.25</td></tr><tr><td>(10.1635, 16.9893]</td><td>1575</td><td>0.25</td><td>3150</td><td>0.5</td></tr><tr><td>(16.9893, 20.5085]</td><td>1574</td><td>0.2498</td><td>4724</td><td>0.749841</td></tr><tr><td>(20.5085, 47.5]</td><td>1576</td><td>0.2502</td><td>6300</td><td>1.0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="boxplot">
<h4><strong>Boxplot</strong><a class="headerlink" href="#boxplot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">statistics</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/338c7091fb0849715fb5d34a4be796c7315d999493f8212f50aeecfabd552cd0.png" src="_images/338c7091fb0849715fb5d34a4be796c7315d999493f8212f50aeecfabd552cd0.png" />
</div>
</div>
</section>
<section id="ecdf-plot">
<h4><strong>ECDF-plot</strong><a class="headerlink" href="#ecdf-plot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecdfplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e5a23b675b6c61fc0cd9697126cf60bc777bd676f4a98215033cd42e1a29c6db.png" src="_images/e5a23b675b6c61fc0cd9697126cf60bc777bd676f4a98215033cd42e1a29c6db.png" />
</div>
</div>
</section>
</section>
<section id="relation-between-response-and-predictors">
<h3><strong>Relation between response and predictors</strong><a class="headerlink" href="#relation-between-response-and-predictors" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">quant_columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;Density&#39;</span><span class="p">]</span>
<span class="n">cat_predictors</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix_response</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">predictors</span><span class="o">=</span><span class="n">quant_predictors</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix_response</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fda9a7e6f4f6c15a51673a5bbea9d0b7193bf3fe26a94cf5bf19b0dfc9101af2.png" src="_images/fda9a7e6f4f6c15a51673a5bbea9d0b7193bf3fe26a94cf5bf19b0dfc9101af2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">bodyfat_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Buy price vs Quantitative predictors&#39;</span><span class="p">,</span> 
               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">quant_predictors</span><span class="p">,</span>
               <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dc7acf98cbbf0457096160ac6feec2ca888807e41a8b27ced18817f4ebb04a05.png" src="_images/dc7acf98cbbf0457096160ac6feec2ca888807e41a8b27ced18817f4ebb04a05.png" />
</div>
</div>
</section>
</section>
<section id="preprocessing-methods">
<h2><strong>Preprocessing Methods</strong><a class="headerlink" href="#preprocessing-methods" title="Link to this heading">#</a></h2>
<section id="imputers">
<h3><strong>Imputers</strong><a class="headerlink" href="#imputers" title="Link to this heading">#</a></h3>
<p>Methods for imputing missing values.</p>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span>.</p>
<p>Assuming that <span class="math notranslate nohighlight">\(X_j\)</span> has missing values <span class="math notranslate nohighlight">\((\small{\Box})\)</span>.</p>
<p>We define the variable <span class="math notranslate nohighlight">\(X_j\)</span> without missing values:</p>
<div class="math notranslate nohighlight">
\[X_j^* = \left(x_{ij} : x_{ij} \neq \small{\Box} \right)^\prime_{i=1,\dots,n}\]</div>
<section id="simple-imputer">
<h4><strong>Simple imputer</strong><a class="headerlink" href="#simple-imputer" title="Link to this heading">#</a></h4>
<p>For <span class="math notranslate nohighlight">\(j=1,\dots , p\)</span> and <span class="math notranslate nohighlight">\(i=1,\dots,n\)</span> :</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(x_{ij} = \small{\Box}\)</span>, then:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(X_j\)</span> is quantitative:</p>
<div class="math notranslate nohighlight">
\[x_{ij} \hspace{0.1cm}\leftarrow\hspace{0.1cm}  \overline{X}_j^* \hspace{0.12cm}\text{or}\hspace{0.12cm} Median(X_j^*)\]</div>
</li>
<li><p>If <span class="math notranslate nohighlight">\(X_j\)</span> is categorical:</p>
<div class="math notranslate nohighlight">
\[x_{ij} \hspace{0.1cm}\leftarrow\hspace{0.1cm}  Mode(X_j^*)\]</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="knn-imputer">
<h4><strong>KNN imputer</strong><a class="headerlink" href="#knn-imputer" title="Link to this heading">#</a></h4>
<p>The set with the indices of the <span class="math notranslate nohighlight">\(k\)</span> nearest observations to <span class="math notranslate nohighlight">\(x_i\)</span> is defined:</p>
<div class="math notranslate nohighlight">
\[k_{id}(x_i) = \underset{h=1,..,n}{\text{arg}} \text{MinSort} (\lbrace \delta^*(x_i, x_h)  \rbrace_{h\neq i=1,\dots , n })[:k]\]</div>
<p>Then, the set of the <span class="math notranslate nohighlight">\(k\)</span>-nearest observations to <span class="math notranslate nohighlight">\(x_i\)</span> can be defined easily:</p>
<div class="math notranslate nohighlight">
\[knn(x_i) = \lbrace x_h : h\in k_{id}(x_i)\rbrace_{h=1,\dots,n}\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta^*\)</span> is the Euclidean NaN distance:</p>
<div class="math notranslate nohighlight">
\[\delta^*(x_i, x_h) = \sqrt{p\cdot \text{mean}(d^*(x_i,x_h)^2)}\]</div>
<p>and <span class="math notranslate nohighlight">\(d*\)</span> is the NaN difference between vectors:</p>
<div class="math notranslate nohighlight">
\[d*(x_i, x_h) = (x_{ij}- x_{hj} : x_{ij}\neq \small{\Box} , x_{ih}\neq \small{\Box})^\prime_{h=1,\dots,n}\]</div>
<p>We define the non-missing values <span class="math notranslate nohighlight">\(k\)</span>-nn version of <span class="math notranslate nohighlight">\(X_j\)</span> as:</p>
<div class="math notranslate nohighlight">
\[X_{j, knn(x_i)}^* = (x_{hj} : x_{hj}\neq \small{\Box}, \hspace{0.1cm} x_{j}\in knn(x_i))^\prime_{h=1,\dots,n}\]</div>
<p>The <strong>imputation rule</strong> is the following:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(x_{ij} = \small{\Box}\)</span>, then:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(X_j\)</span> is quantitative:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[x_{ij} \hspace{0.1cm}\leftarrow\hspace{0.1cm}  \overline{X}^*_{j, knn(x_i)} \hspace{0.12cm}\text{or}\hspace{0.12cm} Median\big(X^*_{j, knn(x_i)}\big)\]</div>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(X_j\)</span> is categorical:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[x_{ij} \hspace{0.1cm}\leftarrow\hspace{0.1cm}  Mode\big(X_{j, knn(x_i)}^*\big)\]</div>
</li>
</ul>
</section>
<section id="iterative-imputer">
<h4><strong>Iterative imputer</strong><a class="headerlink" href="#iterative-imputer" title="Link to this heading">#</a></h4>
<p>For <span class="math notranslate nohighlight">\(j=1,\dots , p\)</span> :</p>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\(X_j\)</span> has missing values <span class="math notranslate nohighlight">\(\Rightarrow\)</span> Continue.<br />
Else <span class="math notranslate nohighlight">\(\Rightarrow\)</span> jump to next <span class="math notranslate nohighlight">\(j\)</span> iteration.</p></li>
<li><p>Apply simple imputation on the rest of predictors  <span class="math notranslate nohighlight">\(Z=(X_h : h\neq j)_{h=1,\dots , p}\)</span></p></li>
<li><p>Train a model with <span class="math notranslate nohighlight">\(X_j\)</span> as response and th rest of predictors <span class="math notranslate nohighlight">\(Z\)</span> as predictors:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[M(\cdot | X=Z, Y=X_j)\]</div>
<ol class="arabic" start="4">
<li><p>Predict the missing values of <span class="math notranslate nohighlight">\(X_j\)</span> with <span class="math notranslate nohighlight">\(M\)</span>.</p>
<p>For <span class="math notranslate nohighlight">\(i=1,\dots , n\)</span>:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(x_{ij} = \small{\Box}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{x}_{ij} = M(z_i | X=Z, Y=X_j)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x_{ij} \leftarrow \widehat{x}_{ij}\)</span></p></li>
</ul>
</li>
</ul>
</li>
</ol>
<section id="visual-explanation-of-iterative-imputer">
<h5><strong>Visual explanation of Iterative imputer</strong><a class="headerlink" href="#visual-explanation-of-iterative-imputer" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/itimp1.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">900</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0e849bb7d20a81550e2ec953c622327fc0100f9987bb38c8a267a38c6eba7b65.png" src="_images/0e849bb7d20a81550e2ec953c622327fc0100f9987bb38c8a267a38c6eba7b65.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/itimp2.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">700</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/19b947db10ddd94fd223e20ac121bec5bebac050c827263825ff175f3d3baed7.png" src="_images/19b947db10ddd94fd223e20ac121bec5bebac050c827263825ff175f3d3baed7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/itimp3.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">700</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9359d6f2aa971b80d8f1f1818a6d228c0b51ad0ff9edc5a45669bea16e53ee6d.png" src="_images/9359d6f2aa971b80d8f1f1818a6d228c0b51ad0ff9edc5a45669bea16e53ee6d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/itimp4.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f805a268d528103bba217ecbe7e4a2ac563abe66ea464817e8b3e0e62ed5bd90.png" src="_images/f805a268d528103bba217ecbe7e4a2ac563abe66ea464817e8b3e0e62ed5bd90.png" />
</div>
</div>
</section>
</section>
</section>
<section id="discretization">
<h3><strong>Discretization</strong><a class="headerlink" href="#discretization" title="Link to this heading">#</a></h3>
<p>Discretization (categorization) of quantitative variables.</p>
<p>Assuming that <span class="math notranslate nohighlight">\(X_j\)</span> is quantitative, we want to discretize it in <span class="math notranslate nohighlight">\(b\)</span> bins.</p>
<section id="quantiles-rule">
<h4><strong>Quantiles rule</strong><a class="headerlink" href="#quantiles-rule" title="Link to this heading">#</a></h4>
<ul>
<li><p>Discretization intervals:</p>
<div class="math notranslate nohighlight">
\[I_{j-1} = (L_{j-1}, L_j], \quad j=1,\dots , b\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[L_{j} = Q_{j/b}(X_j)\]</div>
<p>is the quantile <span class="math notranslate nohighlight">\(j/b\)</span> of <span class="math notranslate nohighlight">\(X_j\)</span>.</p>
<p>For example, if <span class="math notranslate nohighlight">\(b=4\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[L_{0} = Q_{0}(X_j), \hspace{0.1cm} L_{1} = Q_{0.25}(X_j), \hspace{0.1cm} L_{2} = Q_{0.50}(X_j), \hspace{0.1cm} L_{3} = Q_{0.75}(X_j), \hspace{0.1cm} L_{4} = Q_{1}(X_j)\]</div>
</li>
</ul>
<ul>
<li><p>Categorical version of <span class="math notranslate nohighlight">\(X_j\)</span>
$<span class="math notranslate nohighlight">\(\widetilde{X}_j = (\widetilde{x}_{ij})_{i=1,\dots,n}^\prime\)</span>$</p>
<p>where:
$<span class="math notranslate nohighlight">\(\widetilde{x}_{ij} = \begin{cases} 0, \hspace{0.15cm} x_{ij}\in I_0 \\
                                     1, \hspace{0.15cm} x_{ij}\in I_1\\
                                     \dots \\
                                     b-1, \hspace{0.15cm} x_{ij} \in I_{b-1}
                       \end{cases}\)</span>$</p>
</li>
</ul>
</section>
<section id="k-means-rule">
<h4><strong>k-means rule</strong><a class="headerlink" href="#k-means-rule" title="Link to this heading">#</a></h4>
<ul>
<li><p>Apply <span class="math notranslate nohighlight">\(k\)</span>-means <span class="math notranslate nohighlight">\((k=b)\)</span> on <span class="math notranslate nohighlight">\(X_j\)</span>.</p>
<ul class="simple">
<li><p>Clusters are predicted:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\widehat{y}_i \in \lbrace 0,\dots , b-1\rbrace \quad i=1,\dots, n\]</div>
<ul>
<li><p>Cluster <span class="math notranslate nohighlight">\(h\)</span> :</p>
<div class="math notranslate nohighlight">
\[C_h = (x_{ij} : \widehat{y}_i = h)_{i=1,\dots,n}\]</div>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Categorical version of <span class="math notranslate nohighlight">\(X_j\)</span>
$<span class="math notranslate nohighlight">\(\widetilde{X}_j = (\widetilde{x}_{ij})_{i=1,\dots,n}^\prime\)</span>$</p>
<p>where:
$<span class="math notranslate nohighlight">\(\widetilde{x}_{ij} = \begin{cases} 0, \hspace{0.15cm} x_{ij}\in C_0 \\
                                     1, \hspace{0.15cm} x_{ij}\in C_1\\
                                     \dots \\
                                     b-1, \hspace{0.15cm} x_{ij} \in C_{b-1}
                       \end{cases}\)</span>$</p>
</li>
</ul>
</section>
</section>
<section id="features-selection">
<h3><strong>Features Selection</strong><a class="headerlink" href="#features-selection" title="Link to this heading">#</a></h3>
<section id="f-value">
<h4><strong>F-value</strong><a class="headerlink" href="#f-value" title="Link to this heading">#</a></h4>
<p>Assuming a quantitative response <span class="math notranslate nohighlight">\(Y\)</span> and considering <span class="math notranslate nohighlight">\(X_j\)</span> the predictor to analyze.</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(F\)</span>-value:</p>
<div class="math notranslate nohighlight">
\[F(X_j) \propto \dfrac{SS_{mean} - SS_{fit}}{SS_{fit}} = \dfrac{\text{ Variance of $Y$ explained by $X_j$ }}{\text{ Variance of $Y$ not explained by $X_j$ }}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[SS_{mean} = \sum_{i=1}^n (y_i - \overline{Y})^2\]</div>
<div class="math notranslate nohighlight">
\[SS_{fit} = \sum_{i=1}^n (y_i - \widehat{y}_i)^2\]</div>
<div class="math notranslate nohighlight">
\[\widehat{y}_i = M(x_{ij} | X_j, Y) = \widehat{\beta}_0 + \widehat{\beta}_j\cdot x_{ij}\]</div>
</li>
<li><p>Feature selection rule:</p>
<ul class="simple">
<li><p>Predictors are ranked by <span class="math notranslate nohighlight">\(F\)</span>-value in descending order.</p></li>
<li><p>The first <span class="math notranslate nohighlight">\(k\)</span> are selected.</p></li>
</ul>
</li>
<li><p>P-value</p>
<p>Since <span class="math notranslate nohighlight">\(F(X_j)\sim F_{1,n-2}\)</span>, a p-value can be computed:</p>
<div class="math notranslate nohighlight">
\[\text{pvalue}(X_j) = P(F_{1, n-2} \geq F(X_j))\]</div>
<p>This p-value can be interpreted like the probability of <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> of being independent, namely, the probability of select <span class="math notranslate nohighlight">\(X_j\)</span> wrongly.</p>
</li>
</ul>
</section>
<section id="fpr-false-positive-rate">
<h4><strong>Fpr (False Positive Rate)</strong><a class="headerlink" href="#fpr-false-positive-rate" title="Link to this heading">#</a></h4>
<p>For a fixed significance level <span class="math notranslate nohighlight">\(\alpha \in (0,1)\)</span>,</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\text{pvalue}(X_j) \leq \alpha\)</span> <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> Select <span class="math notranslate nohighlight">\(X_j\)</span>.</p></li>
<li><p>Else <span class="math notranslate nohighlight">\(\Rightarrow\)</span> Not select <span class="math notranslate nohighlight">\(X_j\)</span>.</p></li>
</ul>
</section>
<section id="fwe-family-wise-error">
<h4><strong>Fwe (Family Wise Error)</strong><a class="headerlink" href="#fwe-family-wise-error" title="Link to this heading">#</a></h4>
<p>For a fixed significance level <span class="math notranslate nohighlight">\(\alpha \in (0,1)\)</span>,</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\text{pvalue}(X_j) \leq \alpha/p\)</span> <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> Select <span class="math notranslate nohighlight">\(X_j\)</span>.</p></li>
<li><p>Else <span class="math notranslate nohighlight">\(\Rightarrow\)</span> Not select <span class="math notranslate nohighlight">\(X_j\)</span>.</p></li>
</ul>
</section>
<section id="fde-false-discovery-error">
<h4><strong>Fde (False Discovery Error)</strong><a class="headerlink" href="#fde-false-discovery-error" title="Link to this heading">#</a></h4>
<p>Let <span class="math notranslate nohighlight">\(P_j = \text{pvalue}(X_j)\)</span>.</p>
<p>For a fixed significance level <span class="math notranslate nohighlight">\(\alpha \in (0,1)\)</span>,</p>
<ul class="simple">
<li><p>Sort <span class="math notranslate nohighlight">\(P_1,\dots , P_p\)</span> in ascending order <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(P_{(1)}, \dots, P_{(p)}\)</span></p></li>
<li><p>Find the largest <span class="math notranslate nohighlight">\(k\)</span> such that <span class="math notranslate nohighlight">\(P_{(k)} \geq k\cdot \alpha/p\)</span></p></li>
<li><p>Select the predictors associated to <span class="math notranslate nohighlight">\(P_{(1)}, \dots, P_{(k)}\)</span> <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(X_{(1)},\dots , X_{(k)}\)</span></p></li>
</ul>
</section>
<section id="best-subset-selection">
<h4><strong>Best subset selection</strong><a class="headerlink" href="#best-subset-selection" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span>.</p>
<p>This algorithm consider a base model <span class="math notranslate nohighlight">\(M\)</span> and compare all the possible combinations of predictors through the predictive performance of the base model with each one.</p>
<p><strong>Best subset selection algorithm:</strong></p>
<ul class="simple">
<li><p>We train all the possible models with  <span class="math notranslate nohighlight">\(1\)</span> predictor, and select the one with less test prediction error computed by cross validation <span class="math notranslate nohighlight">\(\Rightarrow M_1^*\)</span></p></li>
<li><p>We train all the possible models with  <span class="math notranslate nohighlight">\(2\)</span> predictor, and select the one with less test prediction error computed by cross validation <span class="math notranslate nohighlight">\(\Rightarrow M_2^*\)</span><br />
<span class="math notranslate nohighlight">\(\dots\)</span></p></li>
<li><p>We train all the possible models with  <span class="math notranslate nohighlight">\(p-1\)</span> predictor, and select the one with less test prediction error computed by cross validation <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We train the full model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
</ul>
<p>Among <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with less test prediction error, and its associated predictors are the ones selected.</p>
</section>
<section id="backward-selection">
<h4><strong>Backward selection</strong><a class="headerlink" href="#backward-selection" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span>.</p>
<p>This algorithm consider a base model <span class="math notranslate nohighlight">\(M\)</span> and compare some combinations of predictors through the predictive performance of the base model with each one.</p>
<ul>
<li><p>We consider the full model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
<li><p>We consider all the  models resulting from removing one predictor from the model <span class="math notranslate nohighlight">\(M_p\)</span>, and we select the one with less test prediction error by cross validation <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We consider all the   models resulting from removing one predictor from the model <span class="math notranslate nohighlight">\(M_{p-1}\)</span>, and we select the one with less test prediction error by cross validation <span class="math notranslate nohighlight">\(\Rightarrow M_{p-2}^*\)</span></p>
<p><span class="math notranslate nohighlight">\(\dots\)</span></p>
</li>
<li><p>We consider all the   models resulting from removing one predictor from the model <span class="math notranslate nohighlight">\(M_2\)</span>, and we select the one with less test prediction error by cross validation <span class="math notranslate nohighlight">\(\Rightarrow M_{1}^*\)</span></p></li>
</ul>
<p>Among the models <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with less test prediction error, and its associated predictors are selected.</p>
</section>
<section id="forward-selection">
<h4><strong>Forward selection</strong><a class="headerlink" href="#forward-selection" title="Link to this heading">#</a></h4>
<p>This algorithm consider a base model <span class="math notranslate nohighlight">\(M\)</span> and compare all the possible combinations of predictors through the predictive performance of the base model with each one.</p>
<p>This algorithm consider a base model and compare some combinations of predictors through the predictive performance of the base model with each one.</p>
<ul>
<li><p>We consider all the models with <span class="math notranslate nohighlight">\(1\)</span> predictor,  and we select the one with less test prediction error by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_{1}^*\)</span></p></li>
<li><p>We consider all the  models resulting from adding one predictor to the model <span class="math notranslate nohighlight">\(M_1\)</span>, and we select the one with less test prediction error by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_{2}^*\)</span></p></li>
<li><p>We consider all the  models resulting from adding one predictor to the model <span class="math notranslate nohighlight">\(M_2\)</span>, and we select the one with less test prediction error by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_{3}^*\)</span></p>
<p><span class="math notranslate nohighlight">\(\dots\)</span></p>
</li>
<li><p>We consider all the   models resulting from adding one predictor to the model <span class="math notranslate nohighlight">\(M_p-2\)</span>, and we select the one with less test prediction error by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We consider the full  model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
</ul>
<p>Among the models <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with less test prediction error, and its associated predictors are selected.</p>
</section>
</section>
</section>
<section id="models">
<h2><strong>Models</strong><a class="headerlink" href="#models" title="Link to this heading">#</a></h2>
<section id="linear-regression">
<h3><strong>Linear Regression</strong><a class="headerlink" href="#linear-regression" title="Link to this heading">#</a></h3>
<section id="assumptions">
<h4><strong>Assumptions</strong><a class="headerlink" href="#assumptions" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<ul>
<li><p>The model is defined as follows:</p>
<div class="math notranslate nohighlight">
\[y_i \hspace{0.1cm} =  \hspace{0.1cm} \beta_0 + x_i^\prime \cdot \beta \hspace{0.05cm}+\hspace{0.05cm}  \varepsilon_i\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_i = (x_{i1},\dots, x_{ip})^\prime \in \mathbb{R}^p\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\beta = (\beta_1, \dots, \beta_p)^\prime  \in \mathbb{R}^p\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\varepsilon_i\)</span> is the residual term.</p></li>
</ul>
</li>
<li><p>The residual term has to fulfill the following properties:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E[\varepsilon_i]=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Var(\varepsilon_i)\hspace{0.05cm} =  \hspace{0.05cm}\sigma^2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\varepsilon_i \sim N(0,\sigma)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(cov(\varepsilon_i , \varepsilon_j)\hspace{0.05cm} = \hspace{0.05cm}0  \hspace{0.1cm} ,  \hspace{0.1cm} \forall i\neq j\)</span></p></li>
</ul>
</li>
<li><p>Additional assumptions:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n  \hspace{0.1cm}&gt; \hspace{0.1cm} p+1\hspace{0.3cm}\)</span>  <span class="math notranslate nohighlight">\((\text{nº observations} \hspace{0.05cm}&gt; \hspace{0.05cm} \text{nº of beta coefficients})\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Rg(X) \hspace{0.05cm}= \hspace{0.05cm}p+1\)</span></p></li>
</ul>
<p>These additional assumptions are important because of the <em>dimensionality problem</em>.</p>
</li>
</ul>
</section>
<section id="coefficient-estimation">
<h4><strong>Coefficient estimation</strong><a class="headerlink" href="#coefficient-estimation" title="Link to this heading">#</a></h4>
<p>Parameters <span class="math notranslate nohighlight">\(\beta=(\beta_0, \beta_1, \dots, \beta_p)\)</span> are estimated by Maximum Likelihood or Ordinary Least Square (OLS). Both are equivalent under the previous assumptions.</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta} \hspace{0.1cm} = \hspace{0.1cm} \text{arg}  \hspace{0.1cm}\underset{ \beta}{\text{Min}} \hspace{0.1cm}  \sum_{i=1}^{n} \hspace{0.07cm}(y_i - x_i^\prime \cdot \beta)^2\]</div>
<p>The solution to this problem is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta} \hspace{0.1cm} = \hspace{0.1cm} (X^\prime \cdot X)^{-1} \cdot X^\prime \cdot Y\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X \leftarrow (1,X)\)</span></p></li>
</ul>
</section>
<section id="predictions">
<h4><strong>Predictions</strong><a class="headerlink" href="#predictions" title="Link to this heading">#</a></h4>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span>  of the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i \hspace{0.05cm}=\hspace{0.05cm} \widehat{\beta}_0 + x_i^\prime \cdot \widehat{\beta} \]</div>
<p>Note that <span class="math notranslate nohighlight">\(x_i\)</span> may be any vector of <span class="math notranslate nohighlight">\(\mathbb{R}^p\)</span>.</p>
</section>
<section id="the-curse-of-dimensionality">
<h4><strong>The Curse of Dimensionality</strong><a class="headerlink" href="#the-curse-of-dimensionality" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>If the true relationship between the response variable and the predictors is approximately linear, the predictions obtained with the linear regression model will have a small bias. But if the relationship is not linear the bias will be large.</p></li>
</ul>
<p>Suppose we are in the best case and the true relationship between the response and the predictors is approximately linear, then the predictions have little bias:</p>
<ul class="simple">
<li><p>If the size <span class="math notranslate nohighlight">\(n\)</span> is noticeably larger than the number of predictors <span class="math notranslate nohighlight">\(p\)</span>, that is, <span class="math notranslate nohighlight">\(n&gt;&gt;p\)</span>, then the predictions obtained with the linear regression model will have little variance, therefore the model will have a good performance predicting out-of-sample observations, as their predictions have little bias and variance.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(n \approx p\)</span>, then the predictions obtained with the linear regression model will have a lot of variance, therefore the model will have a poor performance predicting observations outside the train sample, as its predictions have a lot of variance, despite that have little bias.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(n &lt; p\)</span>, then the linear regression model cannot be estimated, since the ordinary least squares problem cannot be solved. This fact is known as the curse of dimensionality in linear regression.</p></li>
</ul>
</section>
</section>
<section id="penalized-linear-regression">
<h3><strong>Penalized Linear Regression</strong><a class="headerlink" href="#penalized-linear-regression" title="Link to this heading">#</a></h3>
<p>To use penalized linear regression methods, the response and predicators must be <strong>standardized</strong> to have mean 0 and variance 1.</p>
<p>We standardize the available samples of the predictors <span class="math notranslate nohighlight">\(\hspace{0.01cm} \mathcal{X}_1,\dots,\mathcal{X}_p\hspace{0.01cm}\)</span> and the response <span class="math notranslate nohighlight">\(\hspace{0.01cm} \mathcal {Y}\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widetilde{Y} = \dfrac{Y - \overline{Y}}{S_{Y}}  \hspace{0.3cm}\Rightarrow \hspace{0.3cm} \widetilde{y}_i = \dfrac{y_i - \overline{y}}{S_{Y}} \\[0.5cm]\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\widetilde{X}_j = \dfrac{X_j - \overline{X}_j}{S_{X_j}}  \hspace{0.3cm}\Rightarrow \hspace{0.3cm} \widetilde{x}_{ij} = \dfrac{x_{ij} - \overline{X}_j}{S_{X_j}} \\\end{split}\]</div>
<p>para <span class="math notranslate nohighlight">\(\hspace{0.1cm}j = 1,\dots,p \)</span>.</p>
<p>Donde:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\overline{Y} = \dfrac{1}{n} \sum_{i=1}^n y_i \hspace{0.15cm} , \hspace{0.45cm} \overline{X}_j = \dfrac{1}{n} \sum_{i=1}^n x_{ij} \\\end{split}\]</div>
<div class="math notranslate nohighlight">
\[S_{Y} = \sqrt{\sum_{i=1}^n (y_{i}- \overline{Y})^2}  \hspace{0.15cm} , \hspace{0.45cm} S_{X_j} = \sqrt{\sum_{i=1}^n (x_{ij}- \overline{X}_j)^2}\]</div>
<p>The reason we standardize the predictors and the response is that it is a way to make the beta coefficients dimensionless.</p>
<p>The units of measurement of the beta coefficients depend on the units of measurement of the predictors and the response. If instead of considering the original predictors and response we consider their standardized versions, which are dimensionless, then the beta coefficients will also be dimensionless, and with it the estimates of these coefficients.</p>
<p>This is relevant because in classical linear regression, without scaling predictors or response, if we had  <span class="math notranslate nohighlight">\(\hspace{0.1cm}\widehat{\beta}_r &gt; \widehat{\beta}_j\hspace{0.1cm}\)</span> this could not be be interpreted as that the predictor <span class="math notranslate nohighlight">\(\hspace{0.1cm}\mathcal{X}_r\hspace{0.1cm}\)</span> was more relevant to explain the response than the predictor <span class="math notranslate nohighlight">\(\hspace{0.1cm}\mathcal{X}_j\hspace {0.1cm}\)</span>, since the estimated coefficients are not directly comparable as they are not measured in the same units, unless the predictors in question are measured in the same units.</p>
<p>On the other hand, if the predictors and the response are standardized, that interpretation is valid, since the estimated betas are dimensionless, and therefore directly comparable.</p>
<p>Now, after standardization, estimated betas close to zero imply little relevance of the associated predictor coefficient to explain or predict the response. And given two different coefficients, if one is greater than the other, the predictor associated with the larger one is more relevant to explaining or predicting the response than the predictor associated with the lower coefficient.</p>
<p><strong>Penalized Least Squares</strong></p>
<p>The Penalized Linear Regression model are basically the Linear Regression model with the difference that the response and the predictors are standardized and the estimation of the beta coefficients is done by penalized ordinary least squares. Now we are going to present the three most popular: <strong>Ridge</strong>, <strong>Lasso</strong> and <strong>ElasticNet</strong>.</p>
</section>
<section id="ridge-regression">
<h3><strong>Ridge Regression</strong><a class="headerlink" href="#ridge-regression" title="Link to this heading">#</a></h3>
<section id="id1">
<h4><strong>Assumptions</strong><a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>Same as in the Linear Regression model, but considering the predictors and response standardized as above.</p>
</section>
<section id="id2">
<h4><strong>Coefficient estimation</strong><a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>Parameters <span class="math notranslate nohighlight">\(\beta=(\beta_0, \beta_1, \dots, \beta_p)\)</span> are estimated by Maximum Likelihood or Ordinary Least Square (OLS). Both are equivalent under the previous assumptions.</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta} \hspace{0.1cm} = \hspace{0.1cm} \text{arg}  \hspace{0.1cm}\underset{ \beta}{\text{Min}} \hspace{0.1cm}  \sum_{i=1}^{n} \hspace{0.07cm}(\widetilde{y}_i - \widetilde{x}_i^\prime \cdot \beta)^2 + \lambda\cdot || \beta ||_2^2\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widetilde{X} \leftarrow (\mathbf{1},\widetilde{X}) \hspace{0.2cm}\Rightarrow\hspace{0.2cm} \widetilde{x}_i^ \prime \leftarrow (1,\widetilde{x}_i^\prime)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda \geq 0\hspace{0.02cm}\)</span> is the penalization parameter.</p></li>
<li><p><span class="math notranslate nohighlight">\(|| \beta ||_2^2 \hspace{0.05cm} = \hspace{0.05cm} \sum_{j=1}^p \hspace{0.02cm} \beta_j^2\hspace{0.08cm}\)</span> is the L2 (euclidean) norm (up to squared), and is a measure of the size of the vector <span class="math notranslate nohighlight">\(\beta\)</span>.</p></li>
</ul>
<p>The solution to this project is the following:</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta}\hspace{0.1cm}=\hspace{0.1cm} \left( \hspace{0.05cm} \widetilde{X}^\prime \cdot \widetilde{X} + \lambda \cdot \mathbb{I}_n \hspace{0.05cm} \right)^{-1} \cdot \widetilde{X}^\prime \cdot \widetilde{Y}\]</div>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p>The expression <span class="math notranslate nohighlight">\(\hspace{0.05cm}\lambda \cdot | | \beta||^2_2\hspace{0.05cm}\)</span> <strong>penalizes</strong> the size of the vector <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
<ul>
<li><p>The larger <span class="math notranslate nohighlight">\(\lambda\)</span>, the greater the penalty imposed on the size of the vector <span class="math notranslate nohighlight">\(\beta\)</span> in the optimization problem.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\lambda = 0\)</span> the optimization problem is ordinary least squares (OLS), typical of the ordinary linear regression model.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\lambda\)</span> is <strong>very large</strong> the solution to the problem <span class="math notranslate nohighlight">\(\widehat{\beta}\)</span> will have a <strong>size</strong> (Euclidean norm) <strong>very small</strong>, that is, the estimated coefficients <span class="math notranslate nohighlight">\(\widehat{\beta}_1, \widehat{\beta}_2,\dots, \widehat{\beta}_p\hspace{0.05cm} \approx \hspace{0.05cm} 0\hspace{0.05cm}\)</span> although all will be <span class="math notranslate nohighlight">\(\hspace{0.05cm}\ neq 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda \hspace{0.01cm}\)</span> must be selected <strong>a priori</strong> from the solution of the Ridge optimization problem. It is a <strong>hyper-parameter</strong> of the Ridge linear regression algorithm.</p></li>
</ul>
</section>
<section id="id3">
<h4><strong>Predictions</strong><a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span>  of the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\widetilde{y}}_i \hspace{0.05cm}=\hspace{0.05cm}  \widetilde{x}_i^\prime \cdot \widehat{\beta} \]</div>
<p>Note that <span class="math notranslate nohighlight">\(\widetilde{x}_i\)</span> depends on <span class="math notranslate nohighlight">\(x_i\)</span> and it may be any vector of <span class="math notranslate nohighlight">\(\mathbb{R}^p\)</span>.</p>
<p>If we want the predictions for the original response, we must destandardize the predictions by applying the inverse operation to that of standardizing, that is, multiplying by the standard deviation and adding the mean of the training response.</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.01cm} y \hspace{0.01cm}}_i \hspace{0.05cm} = \hspace{0.05cm} S_Y \cdot \widehat{\widetilde{y}}_i  + \overline{Y}\]</div>
</section>
<section id="hyper-parameters">
<h4><strong>Hyper-parameters</strong><a class="headerlink" href="#hyper-parameters" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Penalization <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\lambda =\)</span> <code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></li>
</ul>
</section>
<section id="advantages-of-ridge-regression">
<h4><strong>Advantages of Ridge regression</strong><a class="headerlink" href="#advantages-of-ridge-regression" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>The predictions obtained with the linear regression algorithm by ordinary least squares are unbiased but have high variance, especially if <span class="math notranslate nohighlight">\(\hspace{0.015cm}p \approx n \hspace{0.015cm}\)</span>. Furthermore, if <span class="math notranslate nohighlight">\(\hspace{0.015cm}p&gt;n\hspace{0.015cm}\)</span> the algorithm cannot be estimated or trained by ordinary least squares.</p></li>
<li><p>Ridge linear regression is based on the balance between bias and variance. It substantially reduces the variance of the predictions at the cost of slightly increasing their bias. Furthermore, even if <span class="math notranslate nohighlight">\(\hspace{0.015cm}p \approx n \hspace{0.015cm}\)</span> or <span class="math notranslate nohighlight">\(\hspace{0.015cm} p&gt;n\hspace{0.015cm}\)</span> , Ridge regression can work well.</p></li>
<li><p>As a conclusion to the previous point, if <span class="math notranslate nohighlight">\(\hspace{0.015cm}\lambda\hspace{0.015cm}\)</span> is selected correctly, the mean square prediction error will be lower in the Ridge regression than in the ordinary least squares regression, which means leads to better predictive ability of Ridge over ordinary least squares.</p></li>
</ul>
</section>
<section id="disadvantages-of-ridge-regression">
<h4><strong>Disadvantages of Ridge Regression</strong><a class="headerlink" href="#disadvantages-of-ridge-regression" title="Link to this heading">#</a></h4>
<p>The Ridge regression method does not select predictors. That is, although the Ridge regression can bring the estimated betas closer to zero, it does not lead any of them to be exactly zero.</p>
<p>Therefore, Ridge regression will always generate a linear regression model that involves all the predictors initially considered.</p>
<p>Increasing <span class="math notranslate nohighlight">\(\hspace{0.01cm} \lambda \hspace{0.01cm}\)</span> will tend to reduce the magnitudes of the beta coefficients, but will not result in the exclusion of any of the predictors.</p>
<p>Solution: <strong>Lasso Regression</strong></p>
</section>
</section>
<section id="lasso-regression">
<h3><strong>Lasso Regression</strong><a class="headerlink" href="#lasso-regression" title="Link to this heading">#</a></h3>
<section id="id4">
<h4><strong>Assumptions</strong><a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<p>The same as in the Linear Regression model, but considering the predictors and response standardized as above.</p>
</section>
<section id="id5">
<h4><strong>Coefficient estimation</strong><a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<p>Parameters <span class="math notranslate nohighlight">\(\beta=(\beta_0, \beta_1, \dots, \beta_p)\)</span> are estimated by Maximum Likelihood or Ordinary Least Square (OLS). Both are equivalent under the previous assumptions.</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta} \hspace{0.1cm} = \hspace{0.1cm} \text{arg}  \hspace{0.1cm}\underset{ \beta}{\text{Min}} \hspace{0.1cm}  \sum_{i=1}^{n} \hspace{0.07cm}(\widetilde{y}_i - \widetilde{x}_i^\prime \cdot \beta)^2 + \lambda\cdot || \beta ||_1\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widetilde{X} \leftarrow (\mathbf{1},\widetilde{X}) \hspace{0.2cm}\Rightarrow\hspace{0.2cm} \widetilde{x}_i^ \prime \leftarrow (1,\widetilde{x}_i^\prime)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda \geq 0\hspace{0.02cm}\)</span> is the penalization parameter.</p></li>
<li><p><span class="math notranslate nohighlight">\(|| \beta ||_1 \hspace{0.05cm} = \hspace{0.05cm} \sum_{j=1}^p \hspace{0.02cm} | \beta_j |\hspace{0.08cm}\)</span> is the L1 (absolute) norm, and is a measure of the size of the vector <span class="math notranslate nohighlight">\(\beta\)</span>.</p></li>
</ul>
<p>This problem has not a closed solution. So, it must to be solved by mean of numerical non-linear optimization algorithms such as (Quasi) Newton’s or Gradient Descent methods.</p>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p>The expression <span class="math notranslate nohighlight">\(\hspace{0.05cm}\lambda \cdot | | \beta||_1\hspace{0.05cm}\)</span> <strong>penalizes</strong> the size of the vector <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
<ul>
<li><p>The larger <span class="math notranslate nohighlight">\(\lambda\)</span>, the greater the penalty imposed on the size of the vector <span class="math notranslate nohighlight">\(\beta\)</span> in the optimization problem.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\lambda = 0\)</span> the optimization problem is ordinary least squares (OLS), typical of the ordinary linear regression model.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\lambda\)</span> is <strong>very large</strong> the solution to the problem <span class="math notranslate nohighlight">\(\widehat{\beta}\)</span> will have a <strong>size</strong> (absolute norm) <strong>very small</strong>, that is, the estimated coefficients <span class="math notranslate nohighlight">\(\widehat{\beta}_1, \widehat{\beta}_2,\dots, \widehat{\beta}_p\hspace{0.05cm} \approx \hspace{0.05cm} 0\hspace{0.05cm}\)</span> although all will be <span class="math notranslate nohighlight">\(\hspace{0.05cm}\neq 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda \hspace{0.01cm}\)</span> must be selected <strong>a priori</strong> from the solution of the Lasso optimization problem. It is a <strong>hyper-parameter</strong> of the Lasso linear regression algorithm.</p></li>
</ul>
</section>
<section id="id6">
<h4><strong>Predictions</strong><a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for individuals with the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span>  for the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\widetilde{y}}_i \hspace{0.05cm}=\hspace{0.05cm}  \widetilde{x}_i^\prime \cdot \widehat{\beta} \]</div>
<p>Note that <span class="math notranslate nohighlight">\(\widetilde{x}_i\)</span> depends on <span class="math notranslate nohighlight">\(x_i\)</span> and it may be any vector of <span class="math notranslate nohighlight">\(\mathbb{R}^p\)</span>.</p>
<p>If we want the predictions for the original response, we must destandardize the predictions by applying the inverse operation to that of standardizing, that is, multiplying by the standard deviation and adding the mean of the training response.</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.01cm} y \hspace{0.01cm}}_i \hspace{0.05cm} = \hspace{0.05cm} S_Y \cdot \widehat{\widetilde{y}}_i  + \overline{Y}\]</div>
</section>
<section id="id7">
<h4><strong>Hyper-parameters</strong><a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Penalization <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\lambda =\)</span> <code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></li>
</ul>
</section>
</section>
<section id="elasticnet-regression">
<h3><strong>ElasticNet Regression</strong><a class="headerlink" href="#elasticnet-regression" title="Link to this heading">#</a></h3>
<section id="id8">
<h4><strong>Assumptions</strong><a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<p>The same as in the Linear Regression model, but considering the predictors and response standardized as above.</p>
</section>
<section id="id9">
<h4><strong>Coefficient estimation</strong><a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<p>Parameters <span class="math notranslate nohighlight">\(\beta=(\beta_0, \beta_1, \dots, \beta_p)\)</span> are estimated by Maximum Likelihood or Ordinary Least Square (OLS). Both are equivalent under the previous assumptions.</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta} \hspace{0.1cm} = \hspace{0.1cm} \text{arg}  \hspace{0.1cm}\underset{ \beta}{\text{Min}} \hspace{0.1cm}  \sum_{i=1}^{n} \hspace{0.07cm}(\widetilde{y}_i - \widetilde{x}_i^\prime \cdot \beta)^2 + \alpha\cdot \lambda\cdot || \beta ||_1 + (1-\alpha)\cdot \lambda\cdot || \beta ||_2^2\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widetilde{X} \leftarrow (\mathbf{1},\widetilde{X}) \hspace{0.2cm}\Rightarrow\hspace{0.2cm} \widetilde{x}_i^ \prime \leftarrow (1,\widetilde{x}_i^\prime)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda \geq 0\hspace{0.02cm}\)</span> is the penalization parameter.</p></li>
</ul>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\alpha=1 \Rightarrow\)</span> Ridge Regression</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha=0 \Rightarrow\)</span> Lasso Regression</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\in (0,1) \Rightarrow\)</span> ElasticNet Regression</p></li>
</ul>
</section>
<section id="id10">
<h4><strong>Predictions</strong><a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span>  of the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\widetilde{y}}_i \hspace{0.05cm}=\hspace{0.05cm}  \widetilde{x}_i^\prime \cdot \widehat{\beta} \]</div>
<p>Note that <span class="math notranslate nohighlight">\(\widetilde{x}_i\)</span> depends on <span class="math notranslate nohighlight">\(x_i\)</span> and it may be any vector of <span class="math notranslate nohighlight">\(\mathbb{R}^p\)</span>.</p>
<p>If we want the predictions for the original response, we must destandardize the predictions by applying the inverse operation to that of standardizing, that is, multiplying by the standard deviation and adding the mean of the training response.</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.01cm} y \hspace{0.01cm}}_i \hspace{0.05cm} = \hspace{0.05cm} S_Y \cdot \widehat{\widetilde{y}}_i  + \overline{Y}\]</div>
</section>
<section id="id11">
<h4><strong>Hyper-parameters</strong><a class="headerlink" href="#id11" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Ridge-Lasso trade-off <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\alpha=\)</span> <code class="docutils literal notranslate"><span class="pre">l1_ratio</span></code></p></li>
<li><p>Penalization <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\lambda = \)</span> <code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></li>
</ul>
</section>
</section>
<section id="knn">
<h3><strong>KNN</strong><a class="headerlink" href="#knn" title="Link to this heading">#</a></h3>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<p>The <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbors as regression algorithm has the following steps:</p>
<ul>
<li><p>A distance <span class="math notranslate nohighlight">\(\delta\)</span> between observations of <span class="math notranslate nohighlight">\(X\)</span> is define.</p></li>
<li><p>Given an observation <span class="math notranslate nohighlight">\(x_{i}=(x_{i1},\dots , x_{ip})\in\mathbb{R}^p\)</span> of the predictors, the <span class="math notranslate nohighlight">\(\delta\)</span> distance between this new observation and those of <span class="math notranslate nohighlight">\(X\)</span> is computed, that is, <span class="math notranslate nohighlight">\(\delta(x_{i}, x_{h})\)</span> is calculated for <span class="math notranslate nohighlight">\(h=1,\dots,n\)</span>.</p></li>
<li><p>The <span class="math notranslate nohighlight">\(k\)</span> nearest observation to <span class="math notranslate nohighlight">\(\mathbf{x}_{i}\)</span>, according to <span class="math notranslate nohighlight">\(\delta\)</span> distance, are selected.
The set of them is denoted by <span class="math notranslate nohighlight">\(K(\mathbf{x}_{i})_\delta\)</span> and is the set of the <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbors of <span class="math notranslate nohighlight">\(x_{i}\)</span> according to <span class="math notranslate nohighlight">\(\delta\)</span>.</p></li>
<li><p>The <strong>prediction</strong> of the response for the value <span class="math notranslate nohighlight">\(x_i\)</span> of the predictors is is the mean of the response for the <span class="math notranslate nohighlight">\(k\)</span>-nearest neighbors of <span class="math notranslate nohighlight">\(x_i\)</span>:</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.01cm} y \hspace{0.01cm}}_i \hspace{0.05cm} = \hspace{0.05cm} \dfrac{\hspace{0.05cm}1\hspace{0.05cm}}{k} \cdot \sum_{ \hspace{0.05cm} h \hspace{0.05cm} \in \hspace{0.05cm} \Delta } \hspace{0.07cm} y_h \]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Delta \hspace{0.02cm} = \hspace{0.02cm} \small{ \bigl\{ \hspace{0.02cm} h = 1,\dots,n \hspace{0.1cm} : \hspace{0.1cm}  x_h \in K(x_{i})_\delta \hspace{0.02cm} \bigr\} }\hspace{0.03cm}\)</span> is the set of index of the observations of the predictors that belong to <span class="math notranslate nohighlight">\(K(x_{i})_\delta\hspace{0.02cm}\)</span>.</p></li>
</ul>
</li>
</ul>
<section id="id12">
<h4>Hyper-parameters<a class="headerlink" href="#id12" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>The number of neighbors <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(k =\)</span> <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code></p></li>
<li><p>The distance (metric) <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\delta = \)</span> <code class="docutils literal notranslate"><span class="pre">metric</span></code></p></li>
</ul>
</section>
</section>
<section id="regression-trees">
<h3><strong>Regression Trees</strong><a class="headerlink" href="#regression-trees" title="Link to this heading">#</a></h3>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<p>A graphical example of a regression tree is the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/tree.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">750</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/53793e51c31b8e0481c21d067309da73556e0418759c83e6aa51e13804be8e6f.png" src="_images/53793e51c31b8e0481c21d067309da73556e0418759c83e6aa51e13804be8e6f.png" />
</div>
</div>
<p>Where:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(B_j\)</span> denotes the branches of the tree, and are the key elements of decision trees, which depends on the predictors <span class="math notranslate nohighlight">\(X_j\)</span> and the thresholds <span class="math notranslate nohighlight">\(s_j\)</span>.</p>
<ul class="simple">
<li><p>For example, in the above tree:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}B_1 = \lbrace x\in\mathbb{R}^p \hspace{0.1cm}: \hspace{0.1cm} x_{j_1} &lt; s_{j_1} \hspace{0.07cm};\hspace{0.07cm} x_{j_2} &lt; s_{j_2}   \rbrace  \\[0.6cm]\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}B_2 = \lbrace x\in\mathbb{R}^p \hspace{0.1cm}: \hspace{0.1cm} x_{j_1} &lt; s_{j_1} \hspace{0.07cm};\hspace{0.07cm} x_{j_2} \geq s_{j_2}   \rbrace \\[0.6cm]\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}B_3 = \lbrace x\in\mathbb{R}^p \hspace{0.1cm}: \hspace{0.1cm} x_{j_1} \geq s_{j_1}  \rbrace  \\[0.6cm]\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\small{j_1, j_2 =1,\dots , p}\]</div>
</li>
</ul>
<section id="id13">
<h4><strong>Predictions</strong><a class="headerlink" href="#id13" title="Link to this heading">#</a></h4>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span>  of the predictors is:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(x_i\in B_j\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\hspace{0.01cm} y \hspace{0.01cm}}_i \hspace{0.05cm}=\hspace{0.05cm}  \overline{Y}_{B_j} \hspace{0.05cm}=\hspace{0.05cm}  \small{\frac{1}{\# B_j}} \sum_{\substack{i=1 \\ x_i \in B_j}}^n y_i\end{split}\]</div>
</li>
</ul>
<p>Note that <span class="math notranslate nohighlight">\(x_i\)</span> may be any vector of <span class="math notranslate nohighlight">\(\mathbb{R}^p\)</span>.</p>
</section>
<section id="branches-definition">
<h4><strong>Branches definition</strong><a class="headerlink" href="#branches-definition" title="Link to this heading">#</a></h4>
<div class="math notranslate nohighlight">
\[B_1, \dots, B_m \hspace{0.08cm}=\hspace{0.08cm} \text{arg}  \hspace{0.1cm}\underset{ B_1, .., B_m}{\text{Min}} \hspace{0.08cm} \sum_{j=1}^m RSS(B_j)\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}RSS(B_j) = \sum_{\substack{i=1 \\ x_i \in B_j}}^n (y_i - \overline{Y}_{B_j})^2\end{split}\]</div>
<p>is the train error in the branch <span class="math notranslate nohighlight">\(B_j\)</span>.</p>
<p>How to solve this optimization problem? <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <strong>Recursive binary partition algorithm</strong></p>
</section>
<section id="recursive-binary-partition-algorithm">
<h4><strong>Recursive binary partition algorithm</strong><a class="headerlink" href="#recursive-binary-partition-algorithm" title="Link to this heading">#</a></h4>
<p>The problem is solved sequentially (recursive), starting with the node 1 problem, then the node 2 (given the results of the above node problem (node 1)), and so on. Each node problem only consider two branches (binary), which depends on the results of the above nodes problems.</p>
<p>We are not going to go deeper into the details for the shake of brevity.</p>
</section>
<section id="id14">
<h4><strong>Hyper-parameters</strong><a class="headerlink" href="#id14" title="Link to this heading">#</a></h4>
<p>The most important hyper-parameters (but not the only ones) are the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_depth</span></code>: the maximum size tolerated for any branch. The size of a branch is its number of nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_samples_split</span></code>: number of training observations that has to contain a branch to split its terminal node. If it contains less than this min the terminal node is not split and the branch stop growing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_samples_leaf</span></code>: number of training obs that the new two branches created after splitting a terminal node have to contain to keep/consider that split.</p></li>
</ul>
<p>If one of these two new branches contain less than that min, the split is not keep and the initial branch stop growing.</p>
<p>In this last point is important to notice that when a node is split two new branches appear, since branches are defined by a set of conditions and when a node is splitted two new sets of condition appear.</p>
<p>These hyper-parameters control the size of the tree, and serve as stopping criteria for branch growth.</p>
<p>They are applied sequentially.</p>
<p>Focus in a certain branch:</p>
<ol class="arabic simple">
<li><p>If its size is greater than max depth, its terminal node is not splitted.
Else <span class="math notranslate nohighlight">\(\Rightarrow\)</span> 2.</p></li>
<li><p>If the branch contains less training obs than min samples split, its terminal node is not splitted.
Else <span class="math notranslate nohighlight">\(\Rightarrow\)</span> 3.</p></li>
<li><p>If the num of train obs that one (or both) of the two new branches created after splitting its terminal node is lower than min samples leaf, that split is not considered.
Else <span class="math notranslate nohighlight">\(\Rightarrow\)</span> split its terminal node.</p></li>
</ol>
</section>
</section>
<section id="ensembles">
<h3><strong>Ensembles</strong><a class="headerlink" href="#ensembles" title="Link to this heading">#</a></h3>
<p>Model that aggregate other models (base models) to construct another model (meta-model).</p>
<section id="bagging">
<h4><strong>Bagging</strong><a class="headerlink" href="#bagging" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<p>The bagging algorithm has the following steps:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(B\)</span> bootstrap samples <span class="math notranslate nohighlight">\((X_1,Y_1),\dots, (X_B,Y_B)\)</span> are extracted from <span class="math notranslate nohighlight">\((X, Y)\)</span>, with a certain size <span class="math notranslate nohighlight">\(n_b\in \lbrace 1,\dots n\rbrace\)</span> and number of predictors <span class="math notranslate nohighlight">\(p_b\in \lbrace 1,\dots p\rbrace\)</span>, the same for all of them.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(b=1,\dots , B\)</span>:</p>
<ul>
<li><p>The base model <span class="math notranslate nohighlight">\(M\)</span> is trained with <span class="math notranslate nohighlight">\((X_b,Y_b)\)</span> <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(\widetilde{M}_b= M_b(\cdot | X_b,Y_b)\)</span></p></li>
</ul>
</li>
</ul>
<p>The prediction of the response for a given value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span> of the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.03cm} y \hspace{0.03cm}} \hspace{0.05cm} = \hspace{0.05cm} \frac{1}{B} \sum_{b=1}^B \widehat{\hspace{0.03cm} y\hspace{0.03cm}}_i^{(b)}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\widehat{\hspace{0.03cm} y\hspace{0.03cm}}_i^{(b)}= M_b(x_i | X_b,Y_b)\)</span>, namely, is the prediction made by <span class="math notranslate nohighlight">\(\widetilde{M}_b\)</span> for <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
<section id="id15">
<h5><strong>Hyper-parameters</strong><a class="headerlink" href="#id15" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(B =\)</span> <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(n_b = \)</span> <code class="docutils literal notranslate"><span class="pre">max_samples</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(p_b =\)</span> <code class="docutils literal notranslate"><span class="pre">max_features</span></code></p></li>
</ul>
</section>
</section>
<section id="random-forest">
<h4><strong>Random Forest</strong><a class="headerlink" href="#random-forest" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<p>The Random Forest algorithm has the following steps:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(B\)</span> bootstrap samples <span class="math notranslate nohighlight">\((X_1,Y_1),\dots, (X_B,Y_B)\)</span> are extracted from <span class="math notranslate nohighlight">\((X, Y)\)</span>, with a certain size <span class="math notranslate nohighlight">\(n_b\in \lbrace 1,\dots n\rbrace\)</span> and number of predictors <span class="math notranslate nohighlight">\(p_b\in \lbrace 1,\dots p\rbrace\)</span>, the same for all of them.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(b=1,\dots , B\)</span>:</p>
<ul>
<li><p>The <strong>tree</strong> base model <span class="math notranslate nohighlight">\(M\)</span> is trained with <span class="math notranslate nohighlight">\((X_b,Y_b)\)</span> <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(\widetilde{M}_b= M_b(\cdot | X_b,Y_b)\)</span></p>
<ul class="simple">
<li><p>Where tree model <span class="math notranslate nohighlight">\(M\)</span> has the following particularity:</p>
<ol class="arabic simple">
<li><p>In each node problem only consider <span class="math notranslate nohighlight">\(p_{\tiny{RF}} &lt; p\)</span> predictors selected randomly.</p></li>
</ol>
</li>
</ul>
<p>This random selection depend on bootstrap sample, so, it depends on <span class="math notranslate nohighlight">\(b\)</span>, and, therefore, the model as well.</p>
</li>
</ul>
</li>
</ul>
<p>The prediction of the response for a given value <span class="math notranslate nohighlight">\(x_i\in \mathbb{R}^p\)</span> of the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.03cm} y \hspace{0.03cm}} \hspace{0.05cm} = \hspace{0.05cm} \frac{1}{B} \sum_{b=1}^B \widehat{\hspace{0.03cm} y\hspace{0.03cm}}_i^{(b)}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\widehat{\hspace{0.03cm} y\hspace{0.03cm}}_i^{(b)}= M_b(x_i | X_b,Y_b)\)</span>, namely, is the prediction made by <span class="math notranslate nohighlight">\(\widetilde{M}_b\)</span> for <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
<section id="id16">
<h5><strong>Hyper-parameters</strong><a class="headerlink" href="#id16" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(B =\)</span> <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(p_{\tiny{RF}} =\)</span> <code class="docutils literal notranslate"><span class="pre">max_features</span></code></p></li>
</ul>
</section>
</section>
<section id="extra-trees">
<h4><strong>Extra-Trees</strong><a class="headerlink" href="#extra-trees" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<p>The Extra-Trees (Extremely Randomized Trees) algorithm has the following steps:</p>
<ul>
<li><p>The whole data <span class="math notranslate nohighlight">\((X,Y)\)</span> will be used to train each base model (bootstrap sampling is not used).</p></li>
<li><p>For <span class="math notranslate nohighlight">\(b=1,\dots , B\)</span>:</p>
<ul>
<li><p>The <strong>tree</strong> base model <span class="math notranslate nohighlight">\(M_b\)</span> is trained with <span class="math notranslate nohighlight">\((X,Y)\)</span> <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(\widetilde{M}_b = M_b(\cdot | X,Y)\)</span></p>
<ul>
<li><p>Where the tree model <span class="math notranslate nohighlight">\(M_b\)</span> has the following particularities:</p>
<ol class="arabic simple">
<li><p>In each node problem only consider <span class="math notranslate nohighlight">\(p_{\tiny{ET}} &lt; p\)</span> predictors selected randomly.</p></li>
<li><p>The threshold associated to each selected predictor is chosen randomly.</p></li>
</ol>
<p>Both random selections depend on bootstrap sample, so, it depends on <span class="math notranslate nohighlight">\(b\)</span>, and, therefore, the model as well.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The prediction of the response for a given value <span class="math notranslate nohighlight">\(x_i\in \mathbb{R}^p\)</span> of the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{\hspace{0.03cm} y \hspace{0.03cm}}_i \hspace{0.05cm} = \hspace{0.05cm} \frac{1}{B} \sum_{b=1}^B \widehat{\hspace{0.03cm} y\hspace{0.03cm}}_i^{(b)}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\widehat{\hspace{0.03cm} y\hspace{0.03cm}}_i^{(b)} = M_b(x_i | X,Y)\)</span>, namely, the prediction made by <span class="math notranslate nohighlight">\(\widetilde{M}_b\)</span> for <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
<section id="id17">
<h5><strong>Hyper-parameters</strong><a class="headerlink" href="#id17" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(B =\)</span> <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(p_{\tiny{ET}} =\)</span> <code class="docutils literal notranslate"><span class="pre">max_features</span></code></p></li>
</ul>
</section>
</section>
<section id="boosting">
<h4><strong>Boosting</strong><a class="headerlink" href="#boosting" title="Link to this heading">#</a></h4>
</section>
<section id="stacking">
<h4><strong>Stacking</strong><a class="headerlink" href="#stacking" title="Link to this heading">#</a></h4>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span>.</p>
<p><strong>Cross Validation Predictions</strong></p>
<p>An important concept in stacking is Cross Validation (<span class="math notranslate nohighlight">\(k\)</span>-Fold) predictions. First we will explain it.</p>
<p><span class="math notranslate nohighlight">\((X,Y)\)</span> are divided in <span class="math notranslate nohighlight">\(k\)</span> Folds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/cv_predictions.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9307de59ff753573cb3589196fb63a6ccfb4783ffc33389b86e1cb3c18708452.png" src="_images/9307de59ff753573cb3589196fb63a6ccfb4783ffc33389b86e1cb3c18708452.png" />
</div>
</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(M\)</span> cross validation predictions for the <span class="math notranslate nohighlight">\(j\)</span>-th Fold <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow \hspace{0.1cm} \widehat{Y}_{F_j} = M( X_{F_j} | X_{F_{\neq j}}, Y_{F_{\neq j}})\)</span></p>
<ul>
<li><p><span class="math notranslate nohighlight">\(X_{F_{\neq j}} = (X_{F_h} : h\neq j=1,\dots ,k)\quad\)</span> (concatenation by rows)</p></li>
<li><p><span class="math notranslate nohighlight">\(Y_{F_{\neq j}} = (Y_{F_h} : h\neq j=1,\dots ,k)\quad\)</span> (concatenation by rows)</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(M\)</span> cross validation predictions <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow \hspace{0.1cm} \widehat{Y}_{CV} = \left(\widehat{Y}_{F_1},\dots ,  \widehat{Y}_{F_k}\right)\)</span></p></li>
</ul>
<p>Note that cross validation predictions are testing predictions since the model is trained with different observations to the ones predicted.</p>
<p><strong>Stacking algorithm</strong></p>
<ul>
<li><p>Base models: <span class="math notranslate nohighlight">\(M_1,\dots, M_h\)</span></p></li>
<li><p>Meta models: <span class="math notranslate nohighlight">\(M_*\)</span></p></li>
<li><p>Compute Cross Validation Predictions of the response for each base model, using <span class="math notranslate nohighlight">\((X,Y)\)</span>.</p>
<div class="math notranslate nohighlight">
\[\widehat{Y}_{CV}(M_1),\dots ,\widehat{Y}_{CV}(M_h)\]</div>
</li>
<li><p>Stacking data:</p>
<div class="math notranslate nohighlight">
\[\left(X_{ST}, Y\right) = \big(\hspace{0.05cm}\underset{\text{Stacking predictors}}{\underbrace{\widehat{Y}_{CV}(M_1),\dots ,\widehat{Y}_{CV}(M_h)}}, Y \hspace{0.05cm}\big)\]</div>
</li>
<li><p>Train meta-model <span class="math notranslate nohighlight">\(M_*\)</span> with Stacking data <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(\widetilde{M}_* = M_*(\cdot | X_{ST}, Y)\)</span></p></li>
<li><p>Train base-models  <span class="math notranslate nohighlight">\(M_1,\dots, M_h\)</span> with original data <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(\widetilde{M}_j = M_j(\cdot | X, Y), \quad j=1,\dots,h\)</span></p></li>
<li><p>The prediction of the response for a given value <span class="math notranslate nohighlight">\(x_i\in \mathbb{R}^p\)</span> of the predictors is:</p>
<div class="math notranslate nohighlight">
\[M_*(x_i^{\tiny{ST}}| X_{ST}, Y)\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_i^{\tiny{ST}} = (\widehat{y}_{i1}, \dots, \widehat{y}_{ih})\in \mathbb{R}^h\)</span> is the Stacking version of <span class="math notranslate nohighlight">\(x_i\in \mathbb{R}^p\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_{ij} = M_j(x_i | X,Y)\)</span> is the prediction made by the <span class="math notranslate nohighlight">\(j\)</span>-th base model for <span class="math notranslate nohighlight">\(x_i\)</span>, for <span class="math notranslate nohighlight">\(j=1,\dots, h\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(x_i\)</span> may be any vector of <span class="math notranslate nohighlight">\(\mathbb{R}^p\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="inner-outer-evaluation">
<h2><strong>Inner-Outer Evaluation</strong><a class="headerlink" href="#inner-outer-evaluation" title="Link to this heading">#</a></h2>
<section id="validation">
<h3><strong>Validation</strong><a class="headerlink" href="#validation" title="Link to this heading">#</a></h3>
<p>Methods to validate predictive supervised algorithms.</p>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span>.</p>
<section id="simple-validation">
<h4><strong>Simple Validation</strong><a class="headerlink" href="#simple-validation" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/sv.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10ba0cb87d02f5cf78aa17a7b56e840134992e5127ce84d2e5df459eb1f038a9.png" src="_images/10ba0cb87d02f5cf78aa17a7b56e840134992e5127ce84d2e5df459eb1f038a9.png" />
</div>
</div>
<ul class="simple">
<li><p>Usual train size: <span class="math notranslate nohighlight">\(\hspace{0.1cm}60\%-80\%\)</span></p></li>
<li><p>Usual test size: <span class="math notranslate nohighlight">\(\hspace{0.1cm}30\%-20\%\)</span></p></li>
</ul>
<p>The steps to compute a validation metric <span class="math notranslate nohighlight">\(\phi\)</span> by simple validation are the following:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(X,Y\)</span> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\begin{cases}  X_{train} , Y_{train} \\ X_{test}, Y_{test} \end{cases}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\widehat{Y}_{test} = M(X_{test} | X_{train}, Y_{train})\)</span></p></li>
<li><p>Compute the validation metric:</p>
<div class="math notranslate nohighlight">
\[\phi_{sv} = \phi(\widehat{Y}_{test}, Y_{test})\]</div>
</li>
</ul>
<p>Examples of validation metrics (in regression) are:</p>
<ul>
<li><p>MAE:</p>
<div class="math notranslate nohighlight">
\[\phi(\widehat{y}_i , y_i) = \dfrac{1}{n} \sum_{i=1}^n |\widehat{y}_i - y_i|\]</div>
</li>
<li><p>MSE:</p>
<div class="math notranslate nohighlight">
\[\phi(\widehat{y}_i , y_i) = \dfrac{1}{n} \sum_{i=1}^n (\widehat{y}_i - y_i)^2\]</div>
</li>
</ul>
</section>
<section id="k-fold-cross-validation">
<h4><strong>k-Fold Cross Validation</strong><a class="headerlink" href="#k-fold-cross-validation" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;images/kfold.jpg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">250</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/de0a83129e8bfa6864794e3bc321faea4e01b59626c4d1ca7d5564cdb38c68d9.png" src="_images/de0a83129e8bfa6864794e3bc321faea4e01b59626c4d1ca7d5564cdb38c68d9.png" />
</div>
</div>
<p>The steps to compute a validation metric <span class="math notranslate nohighlight">\(\phi\)</span> by simple validation are the following:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(X,Y\)</span> <span class="math notranslate nohighlight">\(\Rightarrow\)</span> <span class="math notranslate nohighlight">\(\begin{cases}  X_{F_1} , Y_{F_1} \\ \dots \\ X_{F_k}, Y_{F_k} \end{cases}\)</span></p></li>
<li><p>For <span class="math notranslate nohighlight">\(j=1,\dots ,k\)</span>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widehat{Y}_{F_j} = M(X_{F_j} | X_{F_{\neq j}}, Y_{F_{\neq j}})\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\phi_{F_j} = \phi(\widehat{Y}_{F_j}, Y_{F_j})\)</span></p></li>
</ul>
</li>
<li><p>Compute the validation metric:</p>
<div class="math notranslate nohighlight">
\[\phi_{cv} = \dfrac{1}{k} \sum_{j=1}^{k}\phi_{F_j}\]</div>
</li>
</ul>
</section>
</section>
<section id="evaluation">
<h3><strong>Evaluation</strong><a class="headerlink" href="#evaluation" title="Link to this heading">#</a></h3>
<section id="evaluation-types">
<h4><strong>Evaluation types</strong><a class="headerlink" href="#evaluation-types" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><strong>Inner evaluation:</strong> compare alternatives (pipelines)</p>
<ul>
<li><p><strong>HPO</strong>: select the best pipeline for each model</p></li>
<li><p><strong>Best model</strong>: select the best pipeline overall</p></li>
</ul>
</li>
<li><p><strong>Outer evaluation:</strong> estimation of future performance</p></li>
</ul>
</section>
<section id="evaluation-schemas">
<h4><strong>Evaluation schemas</strong><a class="headerlink" href="#evaluation-schemas" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><strong>Simple evaluation:</strong></p>
<ul>
<li><p><strong>Outer</strong>: simple validation</p></li>
<li><p><strong>Inner</strong>: simple validation or k-Fold</p></li>
</ul>
</li>
<li><p><strong>Semi-Nested evaluation:</strong></p>
<ul>
<li><p><strong>Outer</strong>: k-Fold</p></li>
<li><p><strong>Inner</strong>: simple validation</p></li>
</ul>
</li>
<li><p><strong>Nested evaluation:</strong></p>
<ul>
<li><p><strong>Outer</strong>: k-Fold</p></li>
<li><p><strong>Inner</strong>: k-Fold</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="machine-learning-workflow">
<h2><strong>Machine Learning Workflow</strong><a class="headerlink" href="#machine-learning-workflow" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Response and Predictors definition</p></li>
<li><p>Preprocessing (transformers):</p>
<ul>
<li><p>Missing value imputation: simple imputer, knn imputer, iterative imputer.</p></li>
<li><p>Scaling data: standard scaler, not scale.</p></li>
<li><p>Discretization: quantiles discretizer, kmeans discretizer, not discretize.</p></li>
<li><p>Feature selection: Fdr, Fpr, Forward, Backward, not feature selection.</p></li>
</ul>
</li>
<li><p>Models (estimators):</p>
<ul>
<li><p>KNN</p></li>
<li><p>Linear Regression</p></li>
<li><p>Ridge Regression</p></li>
<li><p>Lasso Regression</p></li>
<li><p>ElasticNet Regression</p></li>
<li><p>Decision Trees</p></li>
<li><p>Extra Trees</p></li>
<li><p>Random Forest</p></li>
<li><p>Histogram Gradient Boosting</p></li>
<li><p>XGBoost</p></li>
<li><p>SVM (linear)</p></li>
<li><p>Neural Network (Multi-Layer Perceptron)</p></li>
</ul>
</li>
<li><p>Inner-Outer Evaluation schema:</p>
<ul>
<li><p>Nested Cross Validation (Outer: k-Fold ; Inner: k-Fold)</p></li>
</ul>
</li>
<li><p>HPO (inner evaluation)</p>
<ul>
<li><p>Hyper-parameter optimization: selecting the best alternative for each model.</p></li>
</ul>
</li>
<li><p>Model Selection (inner evaluation)</p>
<ul>
<li><p>Selecting the best model overall.</p></li>
</ul>
</li>
<li><p>Predictive analysis</p>
<ul>
<li><p>Estimation of future performance of the best model.</p></li>
<li><p>Predictive intervals for the best model.</p></li>
</ul>
</li>
<li><p>Inference with the best linear regression model</p>
<ul>
<li><p>Coefficients interpretation.</p></li>
<li><p>Significance analysis.</p></li>
</ul>
</li>
</ul>
<section id="response-and-predictors-definition">
<h3><strong>Response and predictors definition</strong><a class="headerlink" href="#response-and-predictors-definition" title="Link to this heading">#</a></h3>
<p>The aim of our project is to estimate the percentage of body fat in a accurate way without the need to use <code class="docutils literal notranslate"><span class="pre">Density</span></code>, since in practice computing <code class="docutils literal notranslate"><span class="pre">Density</span></code> is highly demanding. So, we will no use <code class="docutils literal notranslate"><span class="pre">Density</span></code> as predictor. And our response variable will be <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;BodyFat&#39;</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bodyfat_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;BodyFat&#39;</span><span class="p">,</span> <span class="s1">&#39;Density&#39;</span><span class="p">]]</span>

<span class="c1"># Since sklearn works better with Pandas, we are going define X and Y as Pandas objects.</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">bodyfat_df</span><span class="p">[</span><span class="n">predictors</span><span class="p">]</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">bodyfat_df</span><span class="p">[</span><span class="n">response</span><span class="p">]</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Age&#39;,
 &#39;Weight&#39;,
 &#39;Height&#39;,
 &#39;Neck&#39;,
 &#39;Chest&#39;,
 &#39;Abdomen&#39;,
 &#39;Hip&#39;,
 &#39;Thigh&#39;,
 &#39;Knee&#39;,
 &#39;Ankle&#39;,
 &#39;Biceps&#39;,
 &#39;Forearm&#39;,
 &#39;Wrist&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="hpo">
<h3><strong>HPO</strong><a class="headerlink" href="#hpo" title="Link to this heading">#</a></h3>
<section id="pipelines-definition">
<h4><strong>Pipelines definition</strong><a class="headerlink" href="#pipelines-definition" title="Link to this heading">#</a></h4>
<p>Defining a preprocessign (transformers) pipeline for the quantitative variables an another for the categoricals.</p>
<p>Despite our data set hos not categorical variables we are going to consider <code class="docutils literal notranslate"><span class="pre">Age</span></code> as categorical, since we want to apply a special preprocessing pipeline to this variable which include a discretizer (we want to test the alternative of transforming <code class="docutils literal notranslate"><span class="pre">Age</span></code> in a categorical variable).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;Age&#39;</span><span class="p">]</span>
<span class="n">cat_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>

<span class="n">quant_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">imputer</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">())</span>
    <span class="p">])</span>

<span class="n">cat_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">imputer</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;discretizer&#39;</span><span class="p">,</span> <span class="n">discretizer</span><span class="p">())</span>
    <span class="p">])</span>

<span class="n">quant_cat_processing</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;quant&#39;</span><span class="p">,</span> <span class="n">quant_pipeline</span><span class="p">,</span> <span class="n">quant_predictors</span><span class="p">),</span>
                                                       <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">cat_pipeline</span><span class="p">,</span> <span class="n">cat_predictors</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>Defining a pipeline (transformers + estimators) for each considered model (estimator).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;ridge_regression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;lasso_regression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;elastic_net_regression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;elastic_net&#39;</span><span class="p">,</span> <span class="n">ElasticNet</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;trees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;trees&#39;</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;extra_trees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;extra_trees&#39;</span><span class="p">,</span> <span class="n">ExtraTreesRegressor</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;histGB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;histGB&#39;</span><span class="p">,</span> <span class="n">HistGradientBoostingRegressor</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;XGB&#39;</span><span class="p">,</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s1">&#39;gbtree&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_SVM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;linear_SVM&#39;</span><span class="p">,</span> <span class="n">LinearSVR</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;epsilon_insensitive&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;MLP_NN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;MLP_NN&#39;</span><span class="p">,</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bagging_knn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;bagging_knn&#39;</span><span class="p">,</span> <span class="n">BaggingRegressor</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">KNeighborsRegressor</span><span class="p">(),</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;boosting_trees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;boosting_trees&#39;</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
    <span class="p">])</span>

<span class="c1">#####################################################################</span>

<span class="n">base_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span><span class="p">())</span>
<span class="p">]</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;stacking&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">quant_cat_processing</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;features_selector&#39;</span><span class="p">,</span> <span class="n">features_selector</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;stacking&#39;</span><span class="p">,</span> <span class="n">StackingRegressor</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="n">base_models</span><span class="p">,</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We can plot the pipeline of a certain model to understand it better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-4 {color: black;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer()),
                                                                  (&#x27;scaler&#x27;,
                                                                   scaler())]),
                                                  [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;,
                                                   &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;,
                                                   &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                                   &#x27;Biceps&#x27;, &#x27;Forearm&#x27;,
                                                   &#x27;Wrist&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer()),
                                                                  (&#x27;discretizer&#x27;,
                                                                   discretizer())]),
                                                  [&#x27;Age&#x27;])])),
                (&#x27;features_selector&#x27;, features_selector()),
                (&#x27;knn&#x27;, KNeighborsRegressor())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer()),
                                                                  (&#x27;scaler&#x27;,
                                                                   scaler())]),
                                                  [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;,
                                                   &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;,
                                                   &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                                   &#x27;Biceps&#x27;, &#x27;Forearm&#x27;,
                                                   &#x27;Wrist&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer()),
                                                                  (&#x27;discretizer&#x27;,
                                                                   discretizer())]),
                                                  [&#x27;Age&#x27;])])),
                (&#x27;features_selector&#x27;, features_selector()),
                (&#x27;knn&#x27;, KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessing: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;, imputer()),
                                                 (&#x27;scaler&#x27;, scaler())]),
                                 [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;, &#x27;Chest&#x27;,
                                  &#x27;Abdomen&#x27;, &#x27;Hip&#x27;, &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                  &#x27;Biceps&#x27;, &#x27;Forearm&#x27;, &#x27;Wrist&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;, imputer()),
                                                 (&#x27;discretizer&#x27;,
                                                  discretizer())]),
                                 [&#x27;Age&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox" ><label for="sk-estimator-id-32" class="sk-toggleable__label sk-toggleable__label-arrow">quant</label><div class="sk-toggleable__content"><pre>[&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;, &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;, &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;, &#x27;Biceps&#x27;, &#x27;Forearm&#x27;, &#x27;Wrist&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox" ><label for="sk-estimator-id-33" class="sk-toggleable__label sk-toggleable__label-arrow">imputer</label><div class="sk-toggleable__content"><pre>imputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox" ><label for="sk-estimator-id-34" class="sk-toggleable__label sk-toggleable__label-arrow">scaler</label><div class="sk-toggleable__content"><pre>scaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox" ><label for="sk-estimator-id-35" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>[&#x27;Age&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox" ><label for="sk-estimator-id-36" class="sk-toggleable__label sk-toggleable__label-arrow">imputer</label><div class="sk-toggleable__content"><pre>imputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox" ><label for="sk-estimator-id-37" class="sk-toggleable__label sk-toggleable__label-arrow">discretizer</label><div class="sk-toggleable__content"><pre>discretizer()</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox" ><label for="sk-estimator-id-38" class="sk-toggleable__label sk-toggleable__label-arrow">features_selector</label><div class="sk-toggleable__content"><pre>features_selector()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox" ><label for="sk-estimator-id-39" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div>
</div>
</section>
<section id="grids-for-hpo">
<h4><strong>Grids for HPO</strong><a class="headerlink" href="#grids-for-hpo" title="Link to this heading">#</a></h4>
<p>Despite our evaluation function allow to use grid and random search and <code class="docutils literal notranslate"><span class="pre">Optuna</span></code> for making the aearch of hyper-parameter, we will only use <code class="docutils literal notranslate"><span class="pre">Optuna</span></code>, for the following reasons:</p>
<ul class="simple">
<li><p>Based on Bayesian search.</p></li>
<li><p>Allow to define dynamical (conditioned) grids.</p></li>
<li><p>Very fast (even more than the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> implementation of random search).</p></li>
</ul>
<p>Here we define the grids for both the preprocessing steps of the pipelines and the models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">features_selector</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;preprocessing__quant__imputer__method&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;preprocessing__quant__imputer__method&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;simple_median&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_median&#39;</span><span class="p">,</span> <span class="s1">&#39;knn&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;preprocessing__cat__imputer__method&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;preprocessing__cat__imputer__method&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;simple_median&#39;</span><span class="p">,</span> <span class="s1">&#39;iterative_median&#39;</span><span class="p">,</span> <span class="s1">&#39;knn&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;preprocessing__quant__scaler__apply&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;preprocessing__quant__scaler__apply&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]),</span>
        <span class="s1">&#39;preprocessing__cat__discretizer__apply&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;preprocessing__cat__discretizer__apply&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">features_selector</span> <span class="o">==</span> <span class="s1">&#39;backward_linear_reg&#39;</span> <span class="p">:</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;features_selector__method&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;features_selector__method&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;backward_linear_regression&#39;</span><span class="p">])</span>      
        <span class="p">})</span>
        
    <span class="k">elif</span> <span class="n">features_selector</span> <span class="o">==</span> <span class="s1">&#39;forward_linear_reg&#39;</span> <span class="p">:</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;features_selector__method&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;features_selector__method&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;forward_linear_regression&#39;</span><span class="p">])</span>      
        <span class="p">})</span>

    <span class="k">elif</span> <span class="n">features_selector</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="p">:</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;features_selector__method&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;features_selector__method&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;not_select&#39;</span><span class="p">,</span> <span class="s1">&#39;Fpr&#39;</span><span class="p">,</span> <span class="s1">&#39;Fdr&#39;</span><span class="p">,</span> 
                                                                                             <span class="s1">&#39;backward_linear_regression&#39;</span><span class="p">,</span> 
                                                                                             <span class="s1">&#39;forward_linear_regression&#39;</span><span class="p">,</span>
                                                                                             <span class="s1">&#39;backward_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;forward_knn&#39;</span><span class="p">])</span>      
        <span class="p">})</span>


    <span class="c1"># Conditioned grids</span>
    <span class="k">if</span>  <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;preprocessing__quant__imputer__method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;knn&#39;</span><span class="p">:</span>
        <span class="n">quant_imputer_n_neighbors</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;preprocessing__quant__imputer__n_neighbors&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;preprocessing__quant__imputer__n_neighbors&#39;</span><span class="p">:</span> <span class="n">quant_imputer_n_neighbors</span><span class="p">})</span>

    <span class="k">if</span>  <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;preprocessing__cat__imputer__method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;knn&#39;</span><span class="p">:</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;preprocessing__cat__imputer__n_neighbors&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;preprocessing__cat__imputer__n_neighbors&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)})</span>

    <span class="k">if</span> <span class="s1">&#39;iterative&#39;</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;preprocessing__quant__imputer__method&#39;</span><span class="p">]:</span>
        <span class="n">quant_imputer_n_nearest_features</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;preprocessing__quant__imputer__n_nearest_features&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;preprocessing__quant__imputer__n_nearest_features&#39;</span><span class="p">:</span> <span class="n">quant_imputer_n_nearest_features</span><span class="p">})</span>

    <span class="k">if</span> <span class="s1">&#39;iterative&#39;</span> <span class="ow">in</span> <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;preprocessing__cat__imputer__method&#39;</span><span class="p">]:</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;preprocessing__cat__imputer__n_nearest_features&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;preprocessing__cat__imputer__n_nearest_features&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)})</span>

    <span class="k">if</span> <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;preprocessing__cat__discretizer__apply&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;preprocessing__cat__discretizer__n_bins&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;preprocessing__cat__discretizer__n_bins&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                           <span class="s1">&#39;preprocessing__cat__discretizer__strategy&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;preprocessing__cat__discretizer__strategy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;quantile&#39;</span><span class="p">,</span> <span class="s1">&#39;kmeans&#39;</span><span class="p">])})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for knn</span>
<span class="k">def</span> <span class="nf">param_grid_knn_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># NoT conditioned grid for KNN</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
        <span class="s1">&#39;knn__metric&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;knn__metric&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;minkowski&#39;</span><span class="p">,</span> <span class="s1">&#39;cityblock&#39;</span><span class="p">])</span>
    <span class="p">})</span>

    <span class="c1"># Conditioned grid for KNN</span>
    <span class="k">if</span> <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;knn__metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minkowski&#39;</span><span class="p">:</span>
        <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;knn__p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;knn__p&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for bagging knn</span>
<span class="k">def</span> <span class="nf">param_grid_bagging_knn_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Not conditioned grid for bagging KNN</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;bagging_knn__estimator__n_neighbors&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;bagging_knn__estimator__n_neighbors&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
        <span class="s1">&#39;bagging_knn__estimator__metric&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;bagging_knn__estimator__metric&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;minkowski&#39;</span><span class="p">,</span> <span class="s1">&#39;cityblock&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;bagging_knn__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;bagging_knn__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">]),</span>
        <span class="s1">&#39;bagging_knn__max_features&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;bagging_knn__max_features&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
        <span class="s1">&#39;bagging_knn__max_samples&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;bagging_knn__max_samples&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

    <span class="p">})</span>

    <span class="c1"># Conditioned grid for bagging KNN</span>
    <span class="k">if</span> <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;bagging_knn__estimator__metric&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;minkowski&#39;</span><span class="p">:</span>
        <span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;bagging_knn__estimator__p&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;bagging_knn__estimator__p&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for linear regression</span>
<span class="k">def</span> <span class="nf">param_grid_linear_regression_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for backward linear regression</span>
<span class="k">def</span> <span class="nf">param_grid_linear_regression_backward_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">features_selector</span><span class="o">=</span><span class="s1">&#39;backward_linear_reg&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for forward linear regression</span>
<span class="k">def</span> <span class="nf">param_grid_linear_regression_forward_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">features_selector</span><span class="o">=</span><span class="s1">&#39;forward_linear_reg&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for Ridge</span>
<span class="k">def</span> <span class="nf">param_grid_ridge_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">features_selector</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Specific logic for Ridge</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for Lasso</span>
<span class="k">def</span> <span class="nf">param_grid_lasso_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">features_selector</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;lasso__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;lasso__alpha&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for ElasticNet</span>
<span class="k">def</span> <span class="nf">param_grid_elastic_net_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">features_selector</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;elastic_net__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;elastic_net__alpha&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;elastic_net__l1_ratio&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;elastic_net__l1_ratio&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for trees</span>
<span class="k">def</span> <span class="nf">param_grid_trees_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;trees__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;trees__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]),</span>
        <span class="s1">&#39;trees__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;trees__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
        <span class="s1">&#39;trees__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;trees__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
        <span class="s1">&#39;trees__splitter&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;trees__splitter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="s1">&#39;random&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;trees__criterion&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;trees__criterion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute_error&#39;</span><span class="p">,</span> <span class="s1">&#39;poisson&#39;</span><span class="p">]),</span>
        <span class="c1">#&#39;trees__ccp_alpha&#39;: trial.suggest_categorical(&#39;trees__ccp_alpha&#39;, [0, 0.1, 0.3, 0.5, 0.8])</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for extra-trees</span>
<span class="k">def</span> <span class="nf">param_grid_extra_trees_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;extra_trees__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;extra_trees__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">]),</span>
        <span class="s1">&#39;extra_trees__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;extra_trees__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">55</span><span class="p">]),</span>
        <span class="s1">&#39;extra_trees__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;extra_trees__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;extra_trees__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;extra_trees__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;extra_trees__criterion&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;extra_trees__criterion&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;squared_error&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;extra_trees__max_features&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;extra_trees__max_features&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for boosting trees</span>
<span class="k">def</span> <span class="nf">param_grid_boosting_trees_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;boosting_trees__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;boosting_trees__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">]),</span>
        <span class="s1">&#39;boosting_trees__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;boosting_trees__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]),</span>
        <span class="s1">&#39;boosting_trees__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;boosting_trees__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="s1">&#39;boosting_trees__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;boosting_trees__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for Random Forest</span>
<span class="k">def</span> <span class="nf">param_grid_RF_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;RF__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;RF__n_estimators&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
        <span class="s1">&#39;RF__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;RF__max_depth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="s1">&#39;RF__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;RF__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
        <span class="s1">&#39;RF__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;RF__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for Histogram Gradient Boosting </span>
<span class="k">def</span> <span class="nf">param_grid_histGB_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;histGB__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;histGB__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]),</span>
        <span class="s1">&#39;histGB__l2_regularization&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;histGB__l2_regularization&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;histGB__max_iter&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;histGB__max_iter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for XGBoost</span>
<span class="k">def</span> <span class="nf">param_grid_XGB_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;XGB__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;XGB__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">]),</span>
        <span class="s1">&#39;XGB__l2_regularization&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;XGB__l2_regularization&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;XGB__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;XGB__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">]),</span>
        <span class="s1">&#39;XGB__eta&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;XGB__eta&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;XGB__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;XGB__alpha&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for Linear SVM</span>
<span class="k">def</span> <span class="nf">param_grid_linear_SVM_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;linear_SVM__epsilon&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;linear_SVM__epsilon&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span>
        <span class="s1">&#39;linear_SVM__C&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;linear_SVM__C&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grid for Multi-Layer Perceptron</span>
<span class="k">def</span> <span class="nf">param_grid_MLP_NN_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

    <span class="c1"># Specific logic for Lasso</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;MLP_NN__learning_rate_init&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;MLP_NN__learning_rate_init&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span>
        <span class="s1">&#39;MLP_NN__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;MLP_NN__alpha&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inner-outer-definition">
<h4><strong>Inner-Outer definition</strong><a class="headerlink" href="#inner-outer-definition" title="Link to this heading">#</a></h4>
<p>Nested evaluation is the evaluation schema selected for this project, since is the most accurate one (but also the most demanding computationally). And we consider that we haven’t not enough data as to use Simple validation in the outer, which was our second option.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nested Evaluation</span>

<span class="c1"># Outer: k-fold</span>
<span class="n">outer</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="c1"># Inner: k-fold</span>
<span class="n">inner</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="inner-evaluation-hpo">
<h4><strong>Inner Evaluation (HPO)</strong><a class="headerlink" href="#inner-evaluation-hpo" title="Link to this heading">#</a></h4>
<section id="id18">
<h5><strong>KNN</strong><a class="headerlink" href="#id18" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_knn</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_knn_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">111</span><span class="p">)</span>

<span class="n">nested_evaluation_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 25 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_knn</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_knn</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_knn</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_knn</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_knn</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_knn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3792355777777778
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_knn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 3,
 &#39;preprocessing__cat__imputer__n_neighbors&#39;: 2,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 3,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;knn__n_neighbors&#39;: 1,
 &#39;knn__metric&#39;: &#39;cityblock&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="bagging-knn">
<h5><strong>Bagging KNN</strong><a class="headerlink" href="#bagging-knn" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_bagging_knn</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bagging_knn&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_bagging_knn_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">111</span><span class="p">)</span>

<span class="n">nested_evaluation_bagging_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 30 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_bagging_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_bagging_knn</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_bagging_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_bagging_knn</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_bagging_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_bagging_knn</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_bagging_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_knn_bagging</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_bagging_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_knn_bagging</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_knn_bagging</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4075038183148148
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_knn_bagging</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: False,
 &#39;features_selector__method&#39;: &#39;Fpr&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__imputer__n_neighbors&#39;: 4,
 &#39;bagging_knn__estimator__n_neighbors&#39;: 1,
 &#39;bagging_knn__estimator__metric&#39;: &#39;cityblock&#39;,
 &#39;bagging_knn__n_estimators&#39;: 100,
 &#39;bagging_knn__max_features&#39;: 1.0,
 &#39;bagging_knn__max_samples&#39;: 0.9}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id19">
<h5><strong>Linear Regression</strong><a class="headerlink" href="#id19" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_lin_reg</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_linear_regression_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 16 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_lin_reg</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_lin_reg</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_lin_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_lin_reg</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_linear_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_linear_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_linear_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8662711016489588
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_linear_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: True,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 2,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="backward-linear-regression">
<h5><strong>Backward Linear Regression</strong><a class="headerlink" href="#backward-linear-regression" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_backward_lin_reg</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_linear_regression_backward_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_backward_lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 16 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_backward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_backward_lin_reg</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_backward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_backward_lin_reg</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_backward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_backward_lin_reg</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_backward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_backward_linear_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_backward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_backward_linear_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_backward_linear_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8948458259968068
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_backward_linear_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;backward_linear_regression&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 3,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="forward-linear-regression">
<h5><strong>Forward Linear Regression</strong><a class="headerlink" href="#forward-linear-regression" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_forward_lin_reg</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_linear_regression_forward_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_forward_lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_forward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_forward_lin_reg</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_forward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_forward_lin_reg</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_forward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_forward_lin_reg</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_forward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_forward_linear_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_forward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_forward_linear_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_forward_linear_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.9023200439709544
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_forward_linear_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;iterative_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;forward_linear_regression&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__imputer__n_nearest_features&#39;: 7,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 2,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id20">
<h5><strong>Ridge Regression</strong><a class="headerlink" href="#id20" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_ridge_reg</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;ridge_regression&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_ridge_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_ridge_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 14.40 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_ridge_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_ridge_reg</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_ridge_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_ridge_reg</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_ridge_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_ridge_reg</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_ridge_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_ridge_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_ridge_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_ridge_reg</span><span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_ridge_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8663010490197507
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_ridge_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__imputer__n_neighbors&#39;: 1,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 2,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;ridge__alpha&#39;: 0.010000617752489794}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id21">
<h5><strong>Lasso Regression</strong><a class="headerlink" href="#id21" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_lasso_reg</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;lasso_regression&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_lasso_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_lasso_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 20 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_lasso_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_lasso_reg</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_lasso_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_lasso_reg</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_lasso_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_lasso_reg</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_lasso_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_lasso_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_lasso_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_lasso_reg</span><span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_lasso_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.9313936249348869
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_lasso_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;iterative_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: False,
 &#39;features_selector__method&#39;: &#39;forward_linear_regression&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 1,
 &#39;preprocessing__cat__imputer__n_nearest_features&#39;: 3,
 &#39;lasso__alpha&#39;: 0.1}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id22">
<h5><strong>ElasticNet Regression</strong><a class="headerlink" href="#id22" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_elastic_net_reg</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;elastic_net_regression&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_elastic_net_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_elastic_net_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_elasticnet_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_elastic_net_reg</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_elasticnet_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_elastic_net_reg</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_elasticnet_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_elastic_net_reg</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_elasticnet_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_elasticnet_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_elasticnet_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_elasticnet_reg</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_elasticnet_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.9215631672499403
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_elasticnet_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;iterative_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 3,
 &#39;preprocessing__cat__imputer__n_nearest_features&#39;: 3,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 3,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;elastic_net__alpha&#39;: 0.10130620766002864,
 &#39;elastic_net__l1_ratio&#39;: 0.1}
</pre></div>
</div>
</div>
</div>
</section>
<section id="trees">
<h5><strong>Trees</strong><a class="headerlink" href="#trees" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_trees</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;trees&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_trees_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">nested_evaluation_trees</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>

<span class="c1"># Time: 17 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_trees</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_trees</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_trees</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_trees</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_trees</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5386079296560847
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: True,
 &#39;preprocessing__cat__discretizer__apply&#39;: False,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 1,
 &#39;trees__max_depth&#39;: 30,
 &#39;trees__min_samples_split&#39;: 4,
 &#39;trees__min_samples_leaf&#39;: 2,
 &#39;trees__splitter&#39;: &#39;best&#39;,
 &#39;trees__criterion&#39;: &#39;squared_error&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id23">
<h5><strong>Extra-Trees</strong><a class="headerlink" href="#id23" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_extra_trees</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;extra_trees&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_extra_trees_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">nested_evaluation_extra_trees</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># 50 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_extra_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_extra_trees</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_extra_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_extra_trees</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_extra_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_extra_trees</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_extra_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_extra_trees</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_extra_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_extra_trees</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_extra_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3671490978279551
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_extra_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: True,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 1,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 5,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;extra_trees__n_estimators&#39;: 250,
 &#39;extra_trees__max_depth&#39;: 30,
 &#39;extra_trees__min_samples_split&#39;: 4,
 &#39;extra_trees__min_samples_leaf&#39;: 2,
 &#39;extra_trees__criterion&#39;: &#39;squared_error&#39;,
 &#39;extra_trees__max_features&#39;: 1.0}
</pre></div>
</div>
</div>
</div>
</section>
<section id="boosting-trees">
<h5><strong>Boosting Trees</strong><a class="headerlink" href="#boosting-trees" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_boosting_trees</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;boosting_trees&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_boosting_trees_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">nested_evaluation_boosting_trees</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>

<span class="c1"># Time: 66  mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_boosting_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_boosting_trees</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_boosting_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_boosting_trees</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_boosting_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_boosting_trees</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_boosting_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_boosting_trees</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_boosting_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_boosting_trees</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_boosting_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4030998036725932
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_boosting_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;iterative_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;Fdr&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 2,
 &#39;preprocessing__cat__imputer__n_nearest_features&#39;: 5,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 4,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;boosting_trees__n_estimators&#39;: 130,
 &#39;boosting_trees__max_depth&#39;: 30,
 &#39;boosting_trees__min_samples_split&#39;: 9,
 &#39;boosting_trees__min_samples_leaf&#39;: 4}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id24">
<h5><strong>Random Forest</strong><a class="headerlink" href="#id24" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_RF</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_RF_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_RF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 127 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_RF&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_RF</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_RF&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_RF</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_RF&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_RF</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_RF&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_RF</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_RF&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_RF</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_RF</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.44186808255026944
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_RF</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="histogram-gradient-boosting">
<h5><strong>Histogram gradient Boosting</strong><a class="headerlink" href="#histogram-gradient-boosting" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_histGB</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;histGB&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_histGB_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_histGB</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 60 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_histGB&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_histGB</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_histGB&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_histGB</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_histGB&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_histGB</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_histGB&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_histGB</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_histGB&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_histGB</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_histGB</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.45762346512416335
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_histGB</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: False,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__imputer__n_neighbors&#39;: 4,
 &#39;histGB__max_depth&#39;: 50,
 &#39;histGB__l2_regularization&#39;: 0.02498886309555686,
 &#39;histGB__max_iter&#39;: 200}
</pre></div>
</div>
</div>
</div>
</section>
<section id="xgboost">
<h5><strong>XGBoost</strong><a class="headerlink" href="#xgboost" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_XGB</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_XGB_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_XGB</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 27 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_XGB&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_XGB</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_XGB&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_XGB</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_XGB&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_XGB</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_XGB&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_XGB</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_XGB&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_XGB</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_XGB</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3841848257155653
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_XGB</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: False,
 &#39;preprocessing__cat__discretizer__apply&#39;: False,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 1,
 &#39;XGB__max_depth&#39;: 10,
 &#39;XGB__l2_regularization&#39;: 0.2,
 &#39;XGB__n_estimators&#39;: 150,
 &#39;XGB__eta&#39;: 0.12,
 &#39;XGB__alpha&#39;: 0.72}
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-svm">
<h5><strong>Linear SVM</strong><a class="headerlink" href="#linear-svm" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_linear_SVM</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_SVM&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_linear_SVM_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_linear_SVM</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 11 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_linear_SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_linear_SVM</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_linear_SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_linear_SVM</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_linear_SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_linear_SVM</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_linear_SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_linear_SVM</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_linear_SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_linear_SVM</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_linear_SVM</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.7799278880678624
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_linear_SVM</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: True,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;Fpr&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 4,
 &#39;preprocessing__cat__imputer__n_neighbors&#39;: 3,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 5,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;linear_SVM__epsilon&#39;: 0.001,
 &#39;linear_SVM__C&#39;: 1}
</pre></div>
</div>
</div>
</div>
</section>
<section id="multi-layer-perceptron">
<h5><strong>Multi-Layer Perceptron</strong><a class="headerlink" href="#multi-layer-perceptron" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_MLP_NN</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;MLP_NN&#39;</span><span class="p">],</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_MLP_NN_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">nested_evaluation_MLP_NN</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
<span class="c1"># Time: 68 mins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_MLP_NN&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_MLP_NN</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_MLP_NN&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_MLP_NN</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_MLP_NN&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_MLP_NN</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_MLP_NN&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_MLP_NN</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_MLP_NN&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_MLP_NN</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_MLP_NN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7474074349865035
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_MLP_NN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: True,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 2,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 3,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;quantile&#39;,
 &#39;MLP_NN__learning_rate_init&#39;: 0.01,
 &#39;MLP_NN__alpha&#39;: 0.1}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id25">
<h5><strong>Stacking</strong><a class="headerlink" href="#id25" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p><strong>Stacking 1: KNN-Tree – Linear Regression</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_knn</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;trees&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_trees</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">stacking_1</span> <span class="o">=</span> <span class="n">StackingRegressor</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="n">base_models</span><span class="p">,</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_stacking_1</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">stacking_1</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                                <span class="n">param_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">)</span>

<span class="n">nested_evaluation_stacking_1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_stacking_1&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_1</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_stacking_1&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_1</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_stacking_1&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_stacking_1</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_stacking_1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5773601983660955
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Stacking 2: KNN-Tree – Extra-Trees</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_knn</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;trees&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_trees</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">stacking_2</span> <span class="o">=</span> <span class="n">StackingRegressor</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="n">base_models</span><span class="p">,</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">ExtraTreesRegressor</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_stacking_2_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Not conditioned grid </span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;final_estimator__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">]),</span>
        <span class="s1">&#39;final_estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">55</span><span class="p">]),</span>
        <span class="s1">&#39;final_estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;final_estimator__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;final_estimator__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__max_features&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__max_features&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_stacking_2</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">stacking_2</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_stacking_2_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="n">nested_evaluation_stacking_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_stacking_2&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_2</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_stacking_2&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_2</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_stacking_2&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_2</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_stacking_2&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_stacking_2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_stacking_2&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_stacking_2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_stacking_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.508515624740833
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_stacking_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;final_estimator__n_estimators&#39;: 200,
 &#39;final_estimator__max_depth&#39;: 30,
 &#39;final_estimator__min_samples_split&#39;: 14,
 &#39;final_estimator__min_samples_leaf&#39;: 3,
 &#39;final_estimator__max_features&#39;: 1.0}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Stacking 3: KNN-Tree-XGB – Extra-Trees</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_knn</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;trees&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_trees</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;XGB&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;XGB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_XGB</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">stacking_3</span> <span class="o">=</span> <span class="n">StackingRegressor</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="n">base_models</span><span class="p">,</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">ExtraTreesRegressor</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_stacking_3_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Not conditioned grid </span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;final_estimator__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">]),</span>
        <span class="s1">&#39;final_estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__max_depth&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">55</span><span class="p">]),</span>
        <span class="s1">&#39;final_estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;final_estimator__min_samples_split&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__min_samples_leaf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;final_estimator__min_samples_leaf&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__max_features&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__max_features&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_stacking_3</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">stacking_3</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_stacking_3_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">122</span><span class="p">)</span>

<span class="n">nested_evaluation_stacking_3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_stacking_3&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_3</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_stacking_3&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_3</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_stacking_3&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_3</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_stacking_3&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_stacking_3</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_stacking_3&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_stacking_3</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_stacking_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4224882965842249
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_stacking_3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;final_estimator__n_estimators&#39;: 100,
 &#39;final_estimator__max_depth&#39;: 30,
 &#39;final_estimator__min_samples_split&#39;: 8,
 &#39;final_estimator__min_samples_leaf&#39;: 3,
 &#39;final_estimator__max_features&#39;: 1.0}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Stacking 4: KNN-Tree – XGB</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;knn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_knn</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;trees&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_trees</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">stacking_4</span> <span class="o">=</span> <span class="n">StackingRegressor</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="n">base_models</span><span class="p">,</span> <span class="n">final_estimator</span><span class="o">=</span><span class="n">XGBRegressor</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_stacking_4_optuna</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Not conditioned grid </span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;final_estimator__max_depth&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;final_estimator__max_depth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__l2_regularization&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;final_estimator__l2_regularization&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__n_estimators&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;final_estimator__n_estimators&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">]),</span>
        <span class="s1">&#39;final_estimator__eta&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;final_estimator__eta&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="s1">&#39;final_estimator__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;final_estimator__alpha&#39;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nested_evaluation_stacking_4</span> <span class="o">=</span> <span class="n">NestedEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">stacking_4</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">,</span>
                                     <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_stacking_4_optuna</span><span class="p">,</span> 
                                     <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_absolute_error&#39;</span><span class="p">,</span> 
                                     <span class="n">n_trials</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">105</span><span class="p">)</span>

<span class="n">nested_evaluation_stacking_4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best_params_stacking_4&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_4</span><span class="o">.</span><span class="n">final_best_params</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_inner_score_stacking_4&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_4</span><span class="o">.</span><span class="n">final_inner_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_outer_score_stacking_4&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_evaluation_stacking_4</span><span class="o">.</span><span class="n">final_outer_score</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_stacking_4&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">final_inner_score_stacking_4</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_stacking_4&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">best_params_stacking_4</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">final_inner_score_stacking_4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5383500862004658
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_stacking_4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;final_estimator__max_depth&#39;: 6,
 &#39;final_estimator__l2_regularization&#39;: 0.30000000000000004,
 &#39;final_estimator__n_estimators&#39;: 70,
 &#39;final_estimator__eta&#39;: 0.08,
 &#39;final_estimator__alpha&#39;: 0.78}
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="selecting-the-best-model">
<h3><strong>Selecting the best model</strong><a class="headerlink" href="#selecting-the-best-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="s1">&#39;bagging_knn&#39;</span><span class="p">,</span> <span class="s1">&#39;linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;backward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;forward_linear_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;ridge_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;lasso_reg&#39;</span><span class="p">,</span> <span class="s1">&#39;elasticnet_reg&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;trees&#39;</span><span class="p">,</span> <span class="s1">&#39;extra_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;boosting_trees&#39;</span><span class="p">,</span> <span class="s1">&#39;RF&#39;</span><span class="p">,</span> <span class="s1">&#39;histGB&#39;</span><span class="p">,</span> <span class="s1">&#39;XGB&#39;</span><span class="p">,</span> <span class="s1">&#39;linear_SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;MLP_NN&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;stacking_1&#39;</span><span class="p">,</span> <span class="s1">&#39;stacking_2&#39;</span><span class="p">,</span> <span class="s1">&#39;stacking_3&#39;</span><span class="p">,</span> <span class="s1">&#39;stacking_4&#39;</span><span class="p">])</span>
<span class="n">models_inner_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">models_list</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_inner_score_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">models_inner_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

<span class="n">models_inner_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">)</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">models_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">)]</span>
<span class="n">best_model_inner_score</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">models_inner_scores</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">models_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_model_inner_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection - Nested CV&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d94aa0d21c503037ba3a56d864725459802df18b762f3069b5ba8e39bb41a92a.png" src="_images/d94aa0d21c503037ba3a56d864725459802df18b762f3069b5ba8e39bb41a92a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">limit</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">models_inner_scores</span><span class="p">[</span><span class="n">models_inner_scores</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">],</span> 
                     <span class="n">y</span><span class="o">=</span><span class="n">models_list</span><span class="p">[</span><span class="n">models_inner_scores</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_model_inner_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top-3 Models - Nested CV&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">[</span><span class="n">models_inner_scores</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">])</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">models_inner_scores</span><span class="p">[</span><span class="n">models_inner_scores</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/95469391dbc110934eec6d11b3f713d1a2d49ca378669343321303ab4ec38cc7.png" src="_images/95469391dbc110934eec6d11b3f713d1a2d49ca378669343321303ab4ec38cc7.png" />
</div>
</div>
<section id="best-pipeline-hyper-parameters">
<h4><strong>Best pipeline hyper-parameters</strong><a class="headerlink" href="#best-pipeline-hyper-parameters" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/best_params_</span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">best_params</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;preprocessing__quant__imputer__method&#39;: &#39;knn&#39;,
 &#39;preprocessing__cat__imputer__method&#39;: &#39;simple_median&#39;,
 &#39;preprocessing__quant__scaler__apply&#39;: True,
 &#39;preprocessing__cat__discretizer__apply&#39;: True,
 &#39;features_selector__method&#39;: &#39;not_select&#39;,
 &#39;preprocessing__quant__imputer__n_neighbors&#39;: 1,
 &#39;preprocessing__cat__discretizer__n_bins&#39;: 5,
 &#39;preprocessing__cat__discretizer__strategy&#39;: &#39;kmeans&#39;,
 &#39;extra_trees__n_estimators&#39;: 250,
 &#39;extra_trees__max_depth&#39;: 30,
 &#39;extra_trees__min_samples_split&#39;: 4,
 &#39;extra_trees__min_samples_leaf&#39;: 2,
 &#39;extra_trees__criterion&#39;: &#39;squared_error&#39;,
 &#39;extra_trees__max_features&#39;: 1.0}
</pre></div>
</div>
</div>
</div>
</section>
<section id="features-selected">
<h4><strong>Features selected</strong><a class="headerlink" href="#features-selected" title="Link to this heading">#</a></h4>
<p>Not feature selector applied, so, all the features has been selected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#selected_features = pipelines[best_model].steps[1][1].features_selector_.get_support(indices=True)</span>
<span class="c1">#selected_features = X.columns[selected_features]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="predictive-analysis">
<h3><strong>Predictive analysis</strong><a class="headerlink" href="#predictive-analysis" title="Link to this heading">#</a></h3>
<p>Predictive analysis of the best model.</p>
<section id="estimation-of-future-performance">
<h4><strong>Estimation of future performance</strong><a class="headerlink" href="#estimation-of-future-performance" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Results/final_outer_score_</span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">best_model_future_performance</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimation of future performance by Nested CV </span>
<span class="n">best_model_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.30113535145744197
</pre></div>
</div>
</div>
</div>
<ul>
<li><p>Using simple validation</p>
<p>Is a more optimistic estimation of the model future performance, in comparison with the one obtain through nested evaluation.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="n">best_model</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">)</span>
<span class="n">pipelines</span><span class="p">[</span><span class="n">best_model</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="n">best_model</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.30763731371627917
</pre></div>
</div>
</div>
</div>
</section>
<section id="predictive-plots">
<h4><strong>Predictive plots</strong><a class="headerlink" href="#predictive-plots" title="Link to this heading">#</a></h4>
<p>Several predictive plot to make a diagnosis of the predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictive_plots</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">best_model</span><span class="p">,</span> <span class="n">future_performance</span><span class="o">=</span><span class="n">best_model_future_performance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4f9bab8fc6817e2701b897739f7050487ccaf5ab82e3087652a6af09c4dfcb89.png" src="_images/4f9bab8fc6817e2701b897739f7050487ccaf5ab82e3087652a6af09c4dfcb89.png" />
<img alt="_images/ebc6d45b89c102fc968dab25a718630ea6528528cb7f06bb1daf0f64a2e9c006.png" src="_images/ebc6d45b89c102fc968dab25a718630ea6528528cb7f06bb1daf0f64a2e9c006.png" />
<img alt="_images/a532fd1b52590805a71aeff8a97f51af22fd2d366d526ccd663938d5deb6a23c.png" src="_images/a532fd1b52590805a71aeff8a97f51af22fd2d366d526ccd663938d5deb6a23c.png" />
<img alt="_images/10d40cc2db1741aef099466a26873c2bba0c9e94c215d2112bbf101892df175c.png" src="_images/10d40cc2db1741aef099466a26873c2bba0c9e94c215d2112bbf101892df175c.png" />
</div>
</div>
</section>
<section id="prediction-intervals">
<h4><strong>Prediction Intervals</strong><a class="headerlink" href="#prediction-intervals" title="Link to this heading">#</a></h4>
<p>Prediction intervals estimated by bootstrap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="n">best_model</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">)</span>
<span class="n">predictive_intervals</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="n">best_model</span><span class="p">],</span> <span class="n">B</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">X_train</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="o">=</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Time: 17 mins</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0a2709f90d74ad8e43d0653cd242cad0ea745515cbb53665944ca3827d3fa04d.png" src="_images/0a2709f90d74ad8e43d0653cd242cad0ea745515cbb53665944ca3827d3fa04d.png" />
</div>
</div>
</section>
</section>
<section id="inference">
<h3><strong>Inference</strong><a class="headerlink" href="#inference" title="Link to this heading">#</a></h3>
<section id="coefficient-interpretation-of-the-best-linear-regression-model">
<h4><strong>Coefficient interpretation of the best Linear Regression model</strong><a class="headerlink" href="#coefficient-interpretation-of-the-best-linear-regression-model" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_linear_reg</span><span class="p">)</span>
<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;knn&#x27;,
                                                                           n_nearest_features=7,
                                                                           n_neighbors=4)),
                                                                  (&#x27;scaler&#x27;,
                                                                   scaler(apply=True))]),
                                                  [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;,
                                                   &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;,
                                                   &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                                   &#x27;Biceps&#x27;, &#x27;Forearm&#x27;,
                                                   &#x27;Wrist&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;simple_median&#x27;,
                                                                           n_neighbors=4)),
                                                                  (&#x27;discretizer&#x27;,
                                                                   discretizer(apply=True,
                                                                               n_bins=2,
                                                                               strategy=&#x27;kmeans&#x27;))]),
                                                  [&#x27;Age&#x27;])])),
                (&#x27;features_selector&#x27;, features_selector(method=&#x27;not_select&#x27;)),
                (&#x27;linear_regression&#x27;, LinearRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;knn&#x27;,
                                                                           n_nearest_features=7,
                                                                           n_neighbors=4)),
                                                                  (&#x27;scaler&#x27;,
                                                                   scaler(apply=True))]),
                                                  [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;,
                                                   &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;,
                                                   &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                                   &#x27;Biceps&#x27;, &#x27;Forearm&#x27;,
                                                   &#x27;Wrist&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;simple_median&#x27;,
                                                                           n_neighbors=4)),
                                                                  (&#x27;discretizer&#x27;,
                                                                   discretizer(apply=True,
                                                                               n_bins=2,
                                                                               strategy=&#x27;kmeans&#x27;))]),
                                                  [&#x27;Age&#x27;])])),
                (&#x27;features_selector&#x27;, features_selector(method=&#x27;not_select&#x27;)),
                (&#x27;linear_regression&#x27;, LinearRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessing: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  imputer(method=&#x27;knn&#x27;,
                                                          n_nearest_features=7,
                                                          n_neighbors=4)),
                                                 (&#x27;scaler&#x27;,
                                                  scaler(apply=True))]),
                                 [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;, &#x27;Chest&#x27;,
                                  &#x27;Abdomen&#x27;, &#x27;Hip&#x27;, &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                  &#x27;Biceps&#x27;, &#x27;Forearm&#x27;, &#x27;Wrist&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  imputer(method=&#x27;simple_median&#x27;,
                                                          n_neighbors=4)),
                                                 (&#x27;discretizer&#x27;,
                                                  discretizer(apply=True,
                                                              n_bins=2,
                                                              strategy=&#x27;kmeans&#x27;))]),
                                 [&#x27;Age&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">quant</label><div class="sk-toggleable__content"><pre>[&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;, &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;, &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;, &#x27;Biceps&#x27;, &#x27;Forearm&#x27;, &#x27;Wrist&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">imputer</label><div class="sk-toggleable__content"><pre>imputer(method=&#x27;knn&#x27;, n_nearest_features=7, n_neighbors=4)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">scaler</label><div class="sk-toggleable__content"><pre>scaler(apply=True)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>[&#x27;Age&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">imputer</label><div class="sk-toggleable__content"><pre>imputer(method=&#x27;simple_median&#x27;, n_neighbors=4)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">discretizer</label><div class="sk-toggleable__content"><pre>discretizer(apply=True, n_bins=2, strategy=&#x27;kmeans&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">features_selector</label><div class="sk-toggleable__content"><pre>features_selector(method=&#x27;not_select&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">][</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">intercept_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15.743755945434446
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lin_reg_coefficients</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">][</span><span class="s1">&#39;linear_regression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
<span class="n">lin_reg_coefficients</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-7.64306405,  0.16251362, -0.88431254, -0.29332678, 11.18831405,
       -0.12280761, -0.55309937,  3.2059348 , -0.78069601,  0.71920713,
        1.61088777, -0.26988005,  0.1326339 ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Age&#39;, &#39;Weight&#39;, &#39;Height&#39;, &#39;Neck&#39;, &#39;Chest&#39;, &#39;Abdomen&#39;, &#39;Hip&#39;, &#39;Thigh&#39;,
       &#39;Knee&#39;, &#39;Ankle&#39;, &#39;Biceps&#39;, &#39;Forearm&#39;, &#39;Wrist&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p><strong>Interpretation according the best linear regression model:</strong></p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">Age</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 7.64 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Weight</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> increases in 0.16 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Height</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 0.88 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Neck</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 0.29 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Chest</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> increases in 11.18 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Abdomen</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 0.12 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Hip</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 0.55 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Thigh</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> increases in 3.20 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Knee</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 0.78 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Ankle</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> increases in 0.72 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Biceps</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> increases in 1.61 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Forearm</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> decreases in 0.26 units.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">Wrist</span></code> increases in one unit, <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code> increases in 0.13 units.</p></li>
</ul>
</section>
<section id="predictors-importance-analysis-with-the-best-penalized-linear-regression-model">
<h4><strong>Predictors importance analysis with the best Penalized Linear Regression model</strong><a class="headerlink" href="#predictors-importance-analysis-with-the-best-penalized-linear-regression-model" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;ridge_regression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_ridge_reg</span><span class="p">)</span>
<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;ridge_regression&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;knn&#x27;,
                                                                           n_nearest_features=6,
                                                                           n_neighbors=4)),
                                                                  (&#x27;scaler&#x27;,
                                                                   scaler())]),
                                                  [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;,
                                                   &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;,
                                                   &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                                   &#x27;Biceps&#x27;, &#x27;Forearm&#x27;,
                                                   &#x27;Wrist&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;knn&#x27;,
                                                                           n_nearest_features=3)),
                                                                  (&#x27;discretizer&#x27;,
                                                                   discretizer(apply=True,
                                                                               n_bins=2,
                                                                               strategy=&#x27;kmeans&#x27;))]),
                                                  [&#x27;Age&#x27;])])),
                (&#x27;ridge&#x27;, Ridge(alpha=0.10000411830753107))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;knn&#x27;,
                                                                           n_nearest_features=6,
                                                                           n_neighbors=4)),
                                                                  (&#x27;scaler&#x27;,
                                                                   scaler())]),
                                                  [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;,
                                                   &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;,
                                                   &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                                   &#x27;Biceps&#x27;, &#x27;Forearm&#x27;,
                                                   &#x27;Wrist&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   imputer(method=&#x27;knn&#x27;,
                                                                           n_nearest_features=3)),
                                                                  (&#x27;discretizer&#x27;,
                                                                   discretizer(apply=True,
                                                                               n_bins=2,
                                                                               strategy=&#x27;kmeans&#x27;))]),
                                                  [&#x27;Age&#x27;])])),
                (&#x27;ridge&#x27;, Ridge(alpha=0.10000411830753107))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessing: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;quant&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  imputer(method=&#x27;knn&#x27;,
                                                          n_nearest_features=6,
                                                          n_neighbors=4)),
                                                 (&#x27;scaler&#x27;, scaler())]),
                                 [&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;, &#x27;Chest&#x27;,
                                  &#x27;Abdomen&#x27;, &#x27;Hip&#x27;, &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;,
                                  &#x27;Biceps&#x27;, &#x27;Forearm&#x27;, &#x27;Wrist&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  imputer(method=&#x27;knn&#x27;,
                                                          n_nearest_features=3)),
                                                 (&#x27;discretizer&#x27;,
                                                  discretizer(apply=True,
                                                              n_bins=2,
                                                              strategy=&#x27;kmeans&#x27;))]),
                                 [&#x27;Age&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">quant</label><div class="sk-toggleable__content"><pre>[&#x27;Weight&#x27;, &#x27;Height&#x27;, &#x27;Neck&#x27;, &#x27;Chest&#x27;, &#x27;Abdomen&#x27;, &#x27;Hip&#x27;, &#x27;Thigh&#x27;, &#x27;Knee&#x27;, &#x27;Ankle&#x27;, &#x27;Biceps&#x27;, &#x27;Forearm&#x27;, &#x27;Wrist&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">imputer</label><div class="sk-toggleable__content"><pre>imputer(method=&#x27;knn&#x27;, n_nearest_features=6, n_neighbors=4)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">scaler</label><div class="sk-toggleable__content"><pre>scaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>[&#x27;Age&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">imputer</label><div class="sk-toggleable__content"><pre>imputer(method=&#x27;knn&#x27;, n_nearest_features=3)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">discretizer</label><div class="sk-toggleable__content"><pre>discretizer(apply=True, n_bins=2, strategy=&#x27;kmeans&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge(alpha=0.10000411830753107)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_reg_coefficients</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;ridge_regression&#39;</span><span class="p">][</span><span class="s1">&#39;ridge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
<span class="n">ridge_reg_coefficients</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.29109788,  0.06633816, -0.4583522 , -0.04109189,  1.14626694,
       -0.02094284, -0.11598438,  1.70501731, -0.7585785 ,  0.28383903,
        1.05576006, -0.3803131 ,  0.132631  ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Age&#39;, &#39;Weight&#39;, &#39;Height&#39;, &#39;Neck&#39;, &#39;Chest&#39;, &#39;Abdomen&#39;, &#39;Hip&#39;, &#39;Thigh&#39;,
       &#39;Knee&#39;, &#39;Ankle&#39;, &#39;Biceps&#39;, &#39;Forearm&#39;, &#39;Wrist&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">ridge_reg_coefficients</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ridge_reg_coefficients</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ridge_reg_coefficients</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ridge_reg_coefficients</span><span class="p">[</span><span class="nb">filter</span><span class="p">],</span>
                     <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="nb">filter</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ridge Regression - Predictors Importance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ridge_reg_coefficients</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ridge_reg_coefficients</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cd7d3f57ddc27acf158ed849fdb3c727777d786d437f85a604d3ee89df367777.png" src="_images/cd7d3f57ddc27acf158ed849fdb3c727777d786d437f85a604d3ee89df367777.png" />
</div>
</div>
<p>According to the best Ridge model:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Weight</span></code>, <code class="docutils literal notranslate"><span class="pre">Neck</span></code>, <code class="docutils literal notranslate"><span class="pre">Abdomen</span></code> and<code class="docutils literal notranslate"><span class="pre">Hip</span></code> are not signifivative predictors to explain the response variable <code class="docutils literal notranslate"><span class="pre">BodyFat</span></code>.</p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Body Fat Prediction</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem"><strong>The problem</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dimensions"><strong>Dimensions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types"><strong>Data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unique-values"><strong>Unique values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values"><strong>Missing values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-analysis"><strong>Response analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-between-response-and-predictors"><strong>Relation between response and predictors</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-methods"><strong>Preprocessing Methods</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imputers"><strong>Imputers</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-imputer"><strong>Simple imputer</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-imputer"><strong>KNN imputer</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#iterative-imputer"><strong>Iterative imputer</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#visual-explanation-of-iterative-imputer"><strong>Visual explanation of Iterative imputer</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretization"><strong>Discretization</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quantiles-rule"><strong>Quantiles rule</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-rule"><strong>k-means rule</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-selection"><strong>Features Selection</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#f-value"><strong>F-value</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fpr-false-positive-rate"><strong>Fpr (False Positive Rate)</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fwe-family-wise-error"><strong>Fwe (Family Wise Error)</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fde-false-discovery-error"><strong>Fde (False Discovery Error)</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#best-subset-selection"><strong>Best subset selection</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-selection"><strong>Backward selection</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection"><strong>Forward selection</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#models"><strong>Models</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression"><strong>Linear Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-estimation"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictions"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-curse-of-dimensionality"><strong>The Curse of Dimensionality</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penalized-linear-regression"><strong>Penalized Linear Regression</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression"><strong>Ridge Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hyper-parameters"><strong>Hyper-parameters</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-ridge-regression"><strong>Advantages of Ridge regression</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#disadvantages-of-ridge-regression"><strong>Disadvantages of Ridge Regression</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso-regression"><strong>Lasso Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elasticnet-regression"><strong>ElasticNet Regression</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8"><strong>Assumptions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#knn"><strong>KNN</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Hyper-parameters</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-trees"><strong>Regression Trees</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13"><strong>Predictions</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#branches-definition"><strong>Branches definition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-binary-partition-algorithm"><strong>Recursive binary partition algorithm</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ensembles"><strong>Ensembles</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging"><strong>Bagging</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id15"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest"><strong>Random Forest</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id16"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-trees"><strong>Extra-Trees</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id17"><strong>Hyper-parameters</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boosting"><strong>Boosting</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#stacking"><strong>Stacking</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-outer-evaluation"><strong>Inner-Outer Evaluation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation"><strong>Validation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-validation"><strong>Simple Validation</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#k-fold-cross-validation"><strong>k-Fold Cross Validation</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation"><strong>Evaluation</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-types"><strong>Evaluation types</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-schemas"><strong>Evaluation schemas</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-learning-workflow"><strong>Machine Learning Workflow</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-and-predictors-definition"><strong>Response and predictors definition</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hpo"><strong>HPO</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelines-definition"><strong>Pipelines definition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#grids-for-hpo"><strong>Grids for HPO</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-outer-definition"><strong>Inner-Outer definition</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inner-evaluation-hpo"><strong>Inner Evaluation (HPO)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id18"><strong>KNN</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#bagging-knn"><strong>Bagging KNN</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id19"><strong>Linear Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-linear-regression"><strong>Backward Linear Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-linear-regression"><strong>Forward Linear Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id20"><strong>Ridge Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id21"><strong>Lasso Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id22"><strong>ElasticNet Regression</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#trees"><strong>Trees</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id23"><strong>Extra-Trees</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#boosting-trees"><strong>Boosting Trees</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id24"><strong>Random Forest</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-gradient-boosting"><strong>Histogram gradient Boosting</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost"><strong>XGBoost</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-svm"><strong>Linear SVM</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-layer-perceptron"><strong>Multi-Layer Perceptron</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id25"><strong>Stacking</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-the-best-model"><strong>Selecting the best model</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#best-pipeline-hyper-parameters"><strong>Best pipeline hyper-parameters</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#features-selected"><strong>Features selected</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-analysis"><strong>Predictive analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictive-plots"><strong>Predictive plots</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-intervals"><strong>Prediction Intervals</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inference"><strong>Inference</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-of-the-best-linear-regression-model"><strong>Coefficient interpretation of the best Linear Regression model</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-importance-analysis-with-the-best-penalized-linear-regression-model"><strong>Predictors importance analysis with the best Penalized Linear Regression model</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>